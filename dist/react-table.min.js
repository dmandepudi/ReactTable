/*! react-table 12-11-2014 Author: Erfang Chen */
function buildLAFConfigObject(a){var b=a.formatInstructions,c={multiplier:1,roundTo:2,unit:null,alignment:getColumnAlignment(a)};if(!b)return c;for(var d=b.split(/\s+/),e=0;e<d.length;e++){var f=d[e].split(":",2)[0];c[f]=d[e].split(":",2)[1]}return c}function buildCellLookAndFeel(a,b){"use strict";var c={classes:{},styles:{},value:{}},d=b[a.colTag];a.formatConfig=null!=a.formatConfig?a.formatConfig:buildLAFConfigObject(a);var e=a.formatConfig;return a.cellClassCallback&&(c.classes=a.cellClassCallback(b)),d=formatNumber(d,a,e),e.unit&&(d=d+" "+e.unit),"currency"==a.format&&(d="$"+d),c.styles.textAlign=e.alignment,c.styles.width=a.text.length+"em",c.value=d,c}function getColumnAlignment(a){"use strict";return"number"==a.format||"currency"==a.format?"right":"left"}function formatNumber(a,b,c){return isNaN(a)||"number"!=b.format&&"currency"!=b.format||(a*=c.multiplier,a=a.toFixed(c.roundTo),c.separator&&(a=applyThousandSeparator(a))),a}function applyThousandSeparator(a){var b=a.toString().split(".");return b[0]=b[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),b.join(".")}function buildCustomMenuItems(a,b){var c=[];return b.customMenuItems&&c.push(React.DOM.div({className:"separator"}),b.customMenuItems(a,b)),c}function buildMenu(a){var b=a.table,c=a.columnDef,d=a.style,e=a.isFirstColumn,f={};"right"==d.textAlign?f.right="0%":f.left="0%";var g=SummarizeControl({table:b,columnDef:c}),h=buildCustomMenuItems(b,c),i=[React.DOM.div({className:"menu-item",onClick:b.handleSort.bind(b,c,!0)},"Sort Asc"),React.DOM.div({className:"menu-item",onClick:b.handleSort.bind(b,c,!1)},"Sort Dsc"),g];return e?(i.push(React.DOM.div({className:"separator"})),i.push(React.DOM.div({className:"menu-item",onClick:b.handleGroupBy.bind(b,null)},"Clear Summary")),i.push(React.DOM.div({className:"menu-item",onClick:b.handleCollapseAll.bind(b,null)},"Collapse All")),i.push(React.DOM.div({className:"menu-item",onClick:b.handleExpandAll.bind(b)},"Expand All"))):i.push(React.DOM.div({className:"menu-item",onClick:b.handleRemove.bind(b,c)},"Remove Column")),i.push(h),React.DOM.div({style:f,className:"rt-header-menu"},i)}function buildHeaders(a){var b,c=a.state.columnDefs[0],d={},e=React.DOM.div({className:"rt-headers-container"},React.DOM.div({style:{textAlign:"center"},className:"rt-header-element",key:c.colTag},React.DOM.a({className:"btn-link"},c.text)),buildMenu({table:a,columnDef:c,style:{textAlign:"left"},isFirstColumn:!0})),f=[e];for(b=1;b<a.state.columnDefs.length;b++)c=a.state.columnDefs[b],d={textAlign:"center"},f.push(React.DOM.div({className:"rt-headers-container"},React.DOM.div({style:d,className:"rt-header-element rt-info-header",key:c.colTag},React.DOM.a({className:"btn-link"},c.text)),buildMenu({table:a,columnDef:c,style:d,isFirstColumn:!1})));return f.push(React.DOM.span({className:"rt-header-element rt-add-column",style:{textAlign:"center"}},React.DOM.a({className:"btn-link rt-plus-sign",onClick:a.handleAdd},React.DOM.strong(null,"+")))),React.DOM.div({className:"rt-headers-grand-container"},React.DOM.div({key:"header",className:"rt-headers"},f))}function buildFirstCellForRow(a){var b=a.data,c=a.columnDefs[0],d=a.toggleHide,e=c.colTag;if(!b.sectorPath)return React.DOM.td({key:e},b[e]);var f=b.isDetail?b.sectorPath.length:b.sectorPath.length-1,g={paddingLeft:10+25*f+"px"};if(b.isDetail)var h=React.DOM.td({style:g,key:e},b[e]);else h=React.DOM.td({style:g,key:e},React.DOM.a({onClick:d.bind(null,b),className:"btn-link"},React.DOM.strong(null,b[e])));return h}function buildFooter(a,b){return a.props.columnDefs.length>0?PageNavigator({items:b.allPages.slice(b.pageDisplayRange.start,b.pageDisplayRange.end),activeItem:a.state.currentPage,numPages:b.pageEnd,handleClick:a.handlePageClick}):null}function groupData(a,b,c){var d=buildDataBuckets(a,b),e=aggregateBuckets(d,c,b);return e.concat(a)}function straightSumAggregation(a){for(var b=a.data,c=a.columnDef,d=0,e=0,f=0;f<b.length;f++)e=b[f][c.colTag]||0,d+=e;return d}function average(a){return a.columnDef.weightBy?weightedAverage(a):simpleAverage(a)}function simpleAverage(a){var b=straightSumAggregation(a);return 0==a.data.length?0:b/a.data.length}function weightedAverage(a){for(var b=a.data,c=a.columnDef,d=a.columnDef.weightBy,e=0,f=0;f<b.length;f++)e+=(b[f][c.colTag]||0)*(b[f][d.colTag]||0);var g=straightSumAggregation({data:b,columnDef:d});return 0==g?0:e/g}function count(a){var b,c=a.data,d=a.columnDef,e=0;for(b=0;b<a.data.length;b++)c[b][d.colTag]&&e++;return e}function countDistinct(a){var b,c,d=a.data,e=a.columnDef,f={};for(b=0;b<a.data.length;b++)f[d[b][e.colTag]]=1;var g=0;for(c in f)f.hasOwnProperty(c)&&g++;return 1==g?d[0][e.colTag]:g}function getSectorName(a,b){var c,d="";if("number"==b.format||"currency"==b.format)if(b.groupByRange){for(c=0;c<b.groupByRange.length;c++)if(a[b.colTag]<b.groupByRange[c]){d=b.text+" "+(0!=c?b.groupByRange[c-1]:0)+" - "+b.groupByRange[c];break}d||(d=b.text+" "+b.groupByRange[b.groupByRange.length-1]+"+")}else d=b.text;else d=a[b.colTag];return d}function extractSectors(a,b){for(var c=[],d=0;d<b.length;d++){var e=getSectorName(a,b[d]);c.push(e)}return c}function buildDataBuckets(a,b){for(var c={},d=0;d<a.length;d++){var e=extractSectors(a[d],b);a[d].sectorPath=e,a[d].isDetail=!0;for(var f=0;f<e.length;f++){var g=e.slice(0,f+1),h=generateSectorKey(g);c[h]||(c[h]={data:[],sectorPath:g}),c[h].data.push(a[d])}}return c}function aggregateBuckets(a,b,c){var d=[];for(var e in a)if(a.hasOwnProperty(e)){var f=aggregateSector(a[e],b,c);d.push(f)}return d}function aggregateSector(a,b,c){var d={};d.sectorPath=a.sectorPath,d[b[0].colTag]=a.sectorPath[a.sectorPath.length-1];for(var e=1;e<b.length;e++)d[b[e].colTag]=aggregateColumn(a,b[e],c);return d}function aggregateColumn(a,b,c){var d,e=resolveAggregationMethod(b,c);switch(e){case"sum":d=straightSumAggregation({data:a.data,columnDef:b});break;case"average":d=average({data:a.data,columnDef:b});break;case"count":d=count({data:a.data,columnDef:b});break;case"count_distinct":d=countDistinct({data:a.data,columnDef:b});break;default:d=""}return d}function resolveAggregationMethod(a,b){var c="";if(a.aggregationMethod&&(c=a.aggregationMethod),a.conditionalAggregationMethod&&b&&1==b.length){var d=b[0].colTag;a.conditionalAggregationMethod[d]&&(c=a.conditionalAggregationMethod[d])}return c.toLowerCase()}function shouldHide(a,b,c){var d=!1,e=areAncestorsCollapsed(a.sectorPath,b,c),f=!a.isDetail,g=null!=b[generateSectorKey(a.sectorPath)];return e?d=!0:g&&!f&&(d=!0),d}function areAncestorsCollapsed(a,b,c){for(var d=c.length,e=0;d>e;e++)if(isSubSectorOf(a,b[c[e]]))return!0;return!1}function isSubSectorOf(a,b){if(a.length<=b.length)return!1;for(var c=0;c<b.length;c++)if(a[c]!=b[c])return!1;return!0}function sectorPathMatchesExactly(a,b){"use strict";var c=!0,d=0,e=a.length;if(a.length!=b.length)c=!1;else for(d=0;e>d;d++)a[d]!=b[d]&&(c=!1);return c}function generateRowKey(a,b){var c;return c=a.isDetail?b?a[b]:a.rowCount:generateSectorKey(a.sectorPath)}function generateSectorKey(a){return a?a.join(SECTOR_SEPARATOR):""}function deepCopyData(a){var b=0;return a.map(function(a){var c={};for(var d in a)a.hasOwnProperty(d)&&(c[d]=a[d]);return c.isDetail=!0,c.rowCount=b,b++,c})}function getInitiallyCollapsedSectorPaths(a){var b={};return a.map(function(a){if(a.sectorPath&&a.isDetail){var c=generateSectorKey(a.sectorPath);b[c]||(b[c]=a.sectorPath)}}),b}function computePageDisplayRange(a,b){var c=b,d=Math.min(Math.floor(c/2),a-1),e=c-d;return{start:a-d-1,end:a+e-1}}function adjustHeaders(){var a=this.state.uniqueId,b=0,c=$("#"+a+" .rt-headers-container");c.each(function(){var d=$("#"+a+" .rt-table tr:first td:eq("+b+")").outerWidth()-1;0==b&&1==parseInt(c.first().css("border-right"))&&(d+=1),$(this).width(d),b++})}function getPageArithmetics(a,b){var c={};c.pageSize=a.props.pageSize||50,c.maxDisplayedPages=a.props.maxDisplayedPages||10,c.pageStart=1,c.pageEnd=Math.ceil(b.length/c.pageSize),c.allPages=[];for(var d=c.pageStart;d<=c.pageEnd;d++)c.allPages.push(d);return c.pageDisplayRange=computePageDisplayRange(a.state.currentPage,c.maxDisplayedPages),c.lowerVisualBound=(a.state.currentPage-1)*c.pageSize,c.upperVisualBound=Math.min(a.state.currentPage*c.pageSize-1,b.length),c}function bindHeadersToMenu(a){a.find(".rt-headers-container").each(function(){var a=this;$(a).hover(function(){var b=$(a).position();b.left&&$(a).find(".rt-header-menu").css("left",b.left+"px"),b.right&&$(a).find(".rt-header-menu").css("right",b.right+"px")})})}function uniqueId(a){var b=++idCounter+"";return a?a+b:b}function ReactTableGetInitialState(){var a=prepareTableData.call(this,this.props),b=getInitiallySelectedRows(this.props.selectedRows);return{uniqueId:uniqueId("table"),currentPage:1,height:this.props.height,data:a.data,columnDefs:this.props.columnDefs,collapsedSectorPaths:a.collapsedSectorPaths,collapsedSectorKeys:a.collapsedSectorKeys,selectedRows:b}}function ReactTableHandleSort(a,b){var c=this.state.data,d={sectorSorter:defaultSectorSorter,detailSorter:getSortFunction(a),sortDetailBy:a,sortAsc:b};c.sort(sorterFactory.call(this,d)),this.setState({data:c,sorting:a})}function ReacTableHandleGroupBy(a,b){var c=0,d=[],e=[];if(b&&""!=b&&a){for(d=b.split(","),c=0;c<d.length;c++)isNaN(parseFloat(d[c]))||e.push(parseFloat(d[c]));e.sort(function(a,b){return a-b}),a.groupByRange=e}this.props.groupBy=a?[a]:null;var f=prepareTableData.call(this,this.props);this.state.selectedRows.summaryRows=[],this.setState({currentPage:1,data:f.data,selectedRows:this.state.selectedRows,collapsedSectorPaths:f.collapsedSectorPaths,collapsedSectorKeys:f.collapsedSectorKeys})}function ReactTableHandleAdd(){this.props.beforeColumnAdd&&this.props.beforeColumnAdd()}function ReactTableHandleRemove(a){for(var b=this.state.columnDefs.indexOf(a),c=[],d=0;d<this.state.columnDefs.length;d++)d!=b&&c.push(this.state.columnDefs[d]);this.setState({columnDefs:c}),null!=this.props.afterColumnRemove&&this.props.afterColumnRemove(c,a)}function ReactTableHandleToggleHide(a,b){b.stopPropagation();var c=generateSectorKey(a.sectorPath);null==this.state.collapsedSectorPaths[c]?(this.state.collapsedSectorPaths[c]=a.sectorPath,this.state.collapsedSectorKeys.push(c)):(delete this.state.collapsedSectorPaths[c],this.state.collapsedSectorKeys.splice(this.state.collapsedSectorKeys.indexOf(c),1)),this.setState({collapsedSectorPaths:this.state.collapsedSectorPaths,collapsedSectorKeys:this.state.collapsedSectorKeys})}function ReactTableHandlePageClick(a,b){b.preventDefault();var c=this.props.pageSize||10,d=Math.ceil(this.state.data.length/c);1>a||a>d||this.setState({currentPage:a})}function extractSectorPathKeys(a){"use strict";var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(c);return b}function prepareTableData(a){var b=deepCopyData(a.data);if(a.groupBy){b=groupData(b,a.groupBy,a.columnDefs);var c={sectorSorter:defaultSectorSorter,detailSorter:defaultDetailSorter};b.sort(sorterFactory.call(this,c))}var d=getInitiallyCollapsedSectorPaths(b);return{collapsedSectorPaths:d,collapsedSectorKeys:extractSectorPathKeys(d),data:b}}function ReactHandleRowSelect(a){"use strict";var b=null,c=null,d=!1,e=null;a.isDetail?(b="detailRows",c=generateRowKey(a,this.props.rowKey),e=processDetailRowSelect):(b="summaryRows",c=generateSectorKey(a.sectorPath),e=processSummaryRowSelect),isRowSelected.call(this,a)?delete this.state.selectedRows[b][c]:(this.state.selectedRows[b][c]=1,d=!0),e.call(this,a,d),this.setState({selectedRows:this.state.selectedRows})}function processSummaryRowSelect(a,b){"use strict";var c={detailRows:[],summaryRow:a},d=0,e=this.state.data.length,f=null;for(d=0;e>d;d++)f=this.state.data[d],f.isDetail&&(isSubSectorOf(f.sectorPath,a.sectorPath)||sectorPathMatchesExactly(f.sectorPath,a.sectorPath))&&c.detailRows.push(f);this.props.onSummarySelectCallback&&this.props.onSummarySelectCallback.call(this,c,b)}function processDetailRowSelect(a,b){"use strict";var c=this.props.rowKey;c&&this.props.onSelectCallback&&this.props.onSelectCallback.call(this,a,b)}function getInitiallySelectedRows(a){var b={detailRows:{},summaryRows:{}};a=a||[];for(var c=0;c<a.length;c++)b.detailRows[a[c]]=1;return b}function isRowSelected(a){var b=!1,c=null,d=null;return a.isDetail?(d=generateRowKey(a,this.props.rowKey),b=null!=this.state.selectedRows.detailRows[d]):(c=generateSectorKey(a.sectorPath),b=null!=this.state.selectedRows.summaryRows[c]),b}function sorterFactory(a){var b=a.sectorSorter,c=a.detailSorter,d=a.sortSummaryBy,e=a.sortDetailBy;return sortAsc=a.sortAsc,function(a,f){var g=0;return g=b.call(d,a,f),0==g&&(g=a.isDetail&&!f.isDetail?1:f.isDetail&&!a.isDetail?-1:0,0==g&&(g=c.call(e,a,f),sortAsc||(g*=-1))),g}.bind(this)}function defaultSectorSorter(a,b){return generateSectorKey(a.sectorPath).localeCompare(generateSectorKey(b.sectorPath))}function defaultDetailSorter(a,b){return a.rowCount-b.rowCount}function genericDetailSort(a,b){var c=0;return a[this.colTag]<b[this.colTag]?c=-1:a[this.colTag]>b[this.colTag]&&(c=1),this.asc&&(c*=-1),c}function dateDetailSort(a,b){var c=new Date(a[this.colTag])-new Date(b[this.colTag]);return this.asc&&(c*=-1),c}function getSortFunction(a){var b=a.format||"";if(a.sort)return a.sort;switch(b){case"date":return dateDetailSort;default:return genericDetailSort}}var idCounter=0,SECTOR_SEPARATOR="#",ReactTable=React.createClass({displayName:"ReactTable",getInitialState:ReactTableGetInitialState,handleSort:ReactTableHandleSort,handleAdd:ReactTableHandleAdd,handleRemove:ReactTableHandleRemove,handleToggleHide:ReactTableHandleToggleHide,handleGroupBy:ReacTableHandleGroupBy,handlePageClick:ReactTableHandlePageClick,handleRowSelect:ReactHandleRowSelect,handleCollapseAll:function(){var a=getInitiallyCollapsedSectorPaths(this.state.data);this.setState({currentPage:1,collapsedSectorPaths:a,collapsedSectorKeys:extractSectorPathKeys(a)})},handleExpandAll:function(){this.setState({collapsedSectorPaths:{},collapsedSectorKeys:[]})},addColumn:function(a,b){this.state.columnDefs.push(a);var c={};c.columnDefs=this.state.columnDefs,b&&(c.data=deepCopyData(b)),this.setState(c)},replaceData:function(a){var b={};a&&(b.data=deepCopyData(a),this.props.data=a),this.setState(b)},componentDidMount:function(){setTimeout(function(){adjustHeaders.call(this)}.bind(this)),document.addEventListener("click",adjustHeaders.bind(this)),window.addEventListener("resize",adjustHeaders.bind(this));var a=$(this.getDOMNode());a.find(".rt-scrollable").bind("scroll",function(){a.find(".rt-headers").css({overflow:"auto"}).scrollLeft($(this).scrollLeft()),a.find(".rt-headers").css({overflow:"hidden"})}),bindHeadersToMenu(a)},componentWillUnmount:function(){window.removeEventListener("resize",adjustHeaders.bind(this))},componentDidUpdate:function(){adjustHeaders.call(this),bindHeadersToMenu($(this.getDOMNode()))},render:function(){for(var a=[],b=0;b<this.state.data.length;b++){var c=this.state.data[b];shouldHide(c,this.state.collapsedSectorPaths,this.state.collapsedSectorKeys)||a.push(c)}var d=getPageArithmetics(this,a),e=a.slice(d.lowerVisualBound,d.upperVisualBound+1),f=e.map(function(a){var b=this.props.rowKey;return Row({data:a,key:generateRowKey(a,b),isSelected:isRowSelected.call(this,a),onSelect:this.handleRowSelect,columnDefs:this.state.columnDefs,toggleHide:this.handleToggleHide})},this),g=buildHeaders(this),h=buildFooter(this,d),i={};return this.state.height&&parseInt(this.state.height)>0&&(i.height=this.state.height),React.DOM.div({id:this.state.uniqueId,className:"rt-table-container"},g,React.DOM.div({style:i,className:"rt-scrollable"},React.DOM.table({className:"rt-table"},React.DOM.tbody(null,f))),h)}}),Row=React.createClass({displayName:"Row",render:function(){for(var a=[buildFirstCellForRow(this.props)],b=1;b<this.props.columnDefs.length;b++){var c=this.props.columnDefs[b],d=buildCellLookAndFeel(c,this.props.data),e=React.addons.classSet,f=e(d.classes);a.push(React.DOM.td({className:f,style:d.styles,key:c.colTag},d.value))}var e=React.addons.classSet,f=e({selected:this.props.isSelected&&this.props.data.isDetail,"summary-selected":this.props.isSelected&&!this.props.data.isDetail}),g={cursor:this.props.data.isDetail?"pointer":"inherit"};return React.DOM.tr({onClick:this.props.onSelect.bind(null,this.props.data),className:f,style:g},a)}}),PageNavigator=React.createClass({displayName:"PageNavigator",render:function(){var a=this,b=React.addons.classSet,c=b({disabled:1==this.props.activeItem}),d=b({disabled:this.props.activeItem==this.props.numPages}),e=this.props.items.map(function(b){return React.DOM.li({key:b,className:a.props.activeItem==b?"active":""},React.DOM.a({href:"#",onClick:a.props.handleClick.bind(null,b)},b))});return React.DOM.ul({className:c,className:"pagination pull-right"},React.DOM.li({className:d},React.DOM.a({className:c,href:"#",onClick:this.props.handleClick.bind(null,this.props.activeItem-1)},"«")),e,React.DOM.li({className:d},React.DOM.a({className:d,href:"#",onClick:this.props.handleClick.bind(null,this.props.activeItem+1)},"»")))}}),SummarizeControl=React.createClass({displayName:"SummarizeControl",getInitialState:function(){return{userInputBuckets:""}},handleChange:function(a){this.setState({userInputBuckets:a.target.value})},render:function(){var a=this.props.table,b=this.props.columnDef,c="number"==b.format||"currency"==b.format?React.DOM.div({className:"menu-item-input",onHover:!0,style:{position:"absolute",top:"0%",left:"100%"}},React.DOM.label(null,"Enter Bucket(s)"),React.DOM.input({onChange:this.handleChange,placeholder:"ex: 1,10,15"}),React.DOM.a({onClick:a.handleGroupBy.bind(a,b,this.state.userInputBuckets),className:"btn-link"},"Ok")):null;return React.DOM.div({onClick:null==c?a.handleGroupBy.bind(a,b,null):function(){},style:{position:"relative"},className:"menu-item menu-item-hoverable"},React.DOM.div(null,"Summarize"),c)}});