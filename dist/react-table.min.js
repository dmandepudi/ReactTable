/*! react-table 04-06-2015 Author: Erfang Chen */
function buildLAFConfigObject(a){var b=a.formatInstructions,c={multiplier:1,roundTo:2,unit:null,alignment:getColumnAlignment(a)};if(!b)return c;for(var d=b.split(/\s+/),e=0;e<d.length;e++){var f=d[e].split(":",2)[0];c[f]=d[e].split(":",2)[1]}return c}function _computeCellAlignment(a,b,c){return b.isDetail||isNaN(b[c.colTag])?a:"right"}function buildCellLookAndFeel(a,b){var c={classes:{},styles:{},value:{}},d=b[a.colTag];a.formatConfig=null!=a.formatConfig?a.formatConfig:buildLAFConfigObject(a);var e=a.formatConfig;return a.cellClassCallback&&(c.classes=a.cellClassCallback(b)),d=formatNumber(d,a,e),e.unit&&(d=d+" "+e.unit),"currency"==a.format&&(d="$"+d),c.styles.textAlign=_computeCellAlignment(e.alignment,b,a),c.styles.width=a.text.length+"em",c.value=d,e.showZeroAsBlank&&0==c.value&&(c.value=""),c}function getColumnAlignment(a){return"number"==a.format||"currency"==a.format?"right":"left"}function formatNumber(a,b,c){return isNaN(a)||"number"!=b.format&&"currency"!=b.format||(a*=c.multiplier,a=a.toFixed(c.roundTo),c.separator&&(a=applyThousandSeparator(a))),a}function applyThousandSeparator(a){var b=a.toString().split(".");return b[0]=b[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),b.join(".")}function buildCustomMenuItems(a,b){var c=[],d={position:"absolute",top:"-50%",whiteSpace:"normal",width:"250px"};for(var e in a.props.customMenuItems)for(var f in a.props.customMenuItems[e])if("infoBox"==f&&b[a.props.customMenuItems[e][f]]){var g=10*a.state.columnDefs.indexOf(b)/a.state.columnDefs.length>5?"right":"left",h={};for(var i in d)h[i]=d[i];h[g]="100%",c.push(React.DOM.div({style:{position:"relative"},className:"menu-item menu-item-hoverable"},React.DOM.div(null,e),React.DOM.div({className:"menu-item-input",style:h},React.DOM.div({style:{display:"block"}},b[a.props.customMenuItems[e][f]]))))}return c}function buildMenu(a){var b=a.table,c=a.columnDef,d=a.style,e=a.isFirstColumn,f={};"right"==d.textAlign?f.right="0%":f.left="0%";var g=[],h={sort:[React.DOM.div({className:"menu-item",onClick:b.handleAddSort.bind(null,c,!0)},"Add Sort Asc"),React.DOM.div({className:"menu-item",onClick:b.handleAddSort.bind(null,c,!1)},"Add Sort Dsc"),React.DOM.div({className:"menu-item",onClick:b.replaceData.bind(null,b.props.data,!0)},"Clear Sort")],filter:[React.DOM.div({className:"menu-item",onClick:b.handleClearFilter.bind(null,c)},"Clear Filter"),React.DOM.div({className:"menu-item",onClick:b.handleClearAllFilters.bind(null)},"Clear All Filters")],summarize:[SummarizeControl({table:b,columnDef:c}),React.DOM.div({className:"menu-item",onClick:b.handleGroupBy.bind(null,null)},"Clear Summary")],remove:[React.DOM.div({className:"menu-item",onClick:b.handleRemove.bind(null,c)},"Remove Column")]};if(b.props.defaultMenuItems)for(var i=0;i<b.props.defaultMenuItems.length;i++){var j=b.props.defaultMenuItems[i];_addMenuItems(g,h[j])}else _addMenuItems(g,h.sort),_addMenuItems(g,h.filter),_addMenuItems(g,h.summarize),e||_addMenuItems(g,h.remove);var k=buildCustomMenuItems(b,c);return g.push(k),e&&(g.push(React.DOM.div({className:"separator"})),b.props.disableExporting||(g.push(React.DOM.div({className:"menu-item",onClick:b.handleDownload.bind(null,"excel")},"Download as XLS")),g.push(React.DOM.div({className:"menu-item",onClick:b.handleDownload.bind(null,"pdf")},"Download as PDF"))),g.push(React.DOM.div({className:"menu-item",onClick:b.handleCollapseAll.bind(null,null)},"Collapse All")),g.push(React.DOM.div({className:"menu-item",onClick:b.handleExpandAll.bind(null)},"Expand All"))),React.DOM.div({style:f,className:"rt-header-menu"},g)}function _addMenuItems(a,b){for(var c=0;c<b.length;c++)a.push(b[c])}function toggleFilterBox(a,b){var c=a.state.filterInPlace;c[b]=!c[b],a.setState({filterInPlace:c}),setTimeout(function(){$("input.rt-"+b+"-filter-input").focus()})}function pressedKey(a,b,c){const d=27;a.state.filterInPlace[b]&&c.keyCode==d&&(a.state.filterInPlace[b]=!1,a.setState({filterInPlace:a.state.filterInPlace}))}function buildHeaders(a){var b,c=a.state.columnDefs[0],d={},e="btn-link rt-header-anchor-text"+(a.state.filterInPlace[c.colTag]?" rt-hide":""),f={width:"100%",height:"13px",padding:"0"},g=React.DOM.div({className:"rt-headers-container",onDoubleClick:void 0===a.state.sortAsc||null===a.state.sortAsc||c!=a.state.columnDefSorted?a.handleSort.bind(null,c,!0):c==a.state.columnDefSorted&&a.state.sortAsc?a.handleSort.bind(null,c,!1):a.replaceData.bind(null,a.props.data,!0)},React.DOM.div({style:{textAlign:"center"},className:"rt-header-element",key:c.colTag},React.DOM.a({className:e,onClick:a.props.filtering&&a.props.filtering.disable?null:toggleFilterBox.bind(null,a,c.colTag)},a.state.firstColumnLabel.join("/")),React.DOM.input({style:f,className:"rt-"+c.colTag+"-filter-input rt-filter-input"+(a.state.filterInPlace[c.colTag]?"":" rt-hide"),onChange:a.handleColumnFilter.bind(null,c),onKeyDown:pressedKey.bind(null,a,c.colTag)})),React.DOM.div({className:"rt-caret-container"},void 0!=a.state.sortAsc&&a.state.sortAsc===!0&&c===a.state.columnDefSorted?React.DOM.div({className:"rt-upward-caret"}):null,void 0!=a.state.sortAsc&&a.state.sortAsc===!1&&c===a.state.columnDefSorted?React.DOM.div({className:"rt-downward-caret"}):null),buildMenu({table:a,columnDef:c,style:{textAlign:"left"},isFirstColumn:!0})),h=[g];for(b=1;b<a.state.columnDefs.length;b++){c=a.state.columnDefs[b],d={textAlign:"center"};var e="btn-link rt-header-anchor-text"+(a.state.filterInPlace[c.colTag]?" rt-hide":"");h.push(React.DOM.div({className:"rt-headers-container",onDoubleClick:void 0===a.state.sortAsc||null===a.state.sortAsc||c!=a.state.columnDefSorted?a.handleSort.bind(null,c,!0):c==a.state.columnDefSorted&&a.state.sortAsc?a.handleSort.bind(null,c,!1):a.replaceData.bind(null,a.props.data,!0)},React.DOM.div({style:d,className:"rt-header-element rt-info-header",key:c.colTag},React.DOM.a({className:e,onClick:a.props.filtering&&a.props.filtering.disable?null:toggleFilterBox.bind(null,a,c.colTag)},c.text),React.DOM.input({style:f,className:"rt-"+c.colTag+"-filter-input rt-filter-input"+(a.state.filterInPlace[c.colTag]?"":" rt-hide"),onChange:a.handleColumnFilter.bind(null,c),onKeyDown:pressedKey.bind(null,a,c.colTag)})),React.DOM.div({className:"rt-caret-container"},void 0!=a.state.sortAsc&&a.state.sortAsc===!0&&c===a.state.columnDefSorted?React.DOM.div({className:"rt-upward-caret"}):null,void 0!=a.state.sortAsc&&a.state.sortAsc===!1&&c===a.state.columnDefSorted?React.DOM.div({className:"rt-downward-caret"}):null),buildMenu({table:a,columnDef:c,style:d,isFirstColumn:!1})))}var i,j="btn-link rt-plus-sign";return!a.props.disableAddColumnIcon&&a.props.cornerIcon&&(i=React.DOM.img({src:a.props.cornerIcon}),j="btn-link rt-corner-image"),h.push(React.DOM.span({className:"rt-header-element rt-add-column",style:{textAlign:"center"}},React.DOM.a({className:j,onClick:a.props.disableAddColumn?null:a.handleAdd},React.DOM.strong(null,i?i:a.props.disableAddColumn?"":"+")))),React.DOM.div({className:"rt-headers-grand-container"},React.DOM.div({key:"header",className:"rt-headers"},h))}function buildFirstCellForRow(){var a,b,c=this.props,d=c.data,e=c.columnDefs[0],f=c.toggleHide,g=e.colTag;if(!d.sectorPath)return React.DOM.td({key:g,onDoubleClick:this.props.filtering&&this.props.filtering.doubleClickCell?this.props.handleColumnFilter(null,e):null},d[g]);var h=d.isDetail?d.sectorPath.length:d.sectorPath.length-1,i={paddingLeft:10+25*h+"px"};return a=!d.isDetail&&e.summaryTemplate?e.summaryTemplate.call(null,d):null,b=d.isDetail?React.DOM.td({style:i,key:g,onDoubleClick:this.props.filtering&&this.props.filtering.doubleClickCell?this.props.handleColumnFilter(null,e):null},d[g]):React.DOM.td({style:i,key:g},React.DOM.a({onClick:f.bind(null,d),className:"btn-link rt-expansion-link"},d.treeNode.collapsed?"+":"—"),"  ",React.DOM.strong(null,d[g]),a)}function buildFooter(a,b){return a.props.columnDefs.length>0&&!a.props.disablePagination?PageNavigator({items:b.allPages.slice(b.pageDisplayRange.start,b.pageDisplayRange.end),activeItem:a.state.currentPage,numPages:b.pageEnd,handleClick:a.handlePageClick}):null}function getSectorName(a,b){var c="",d=null;if("number"==b.format||"currency"==b.format){var e=_resolveNumericSectorName(b,a);c=e.sectorName,d=e.sortIndex}else c=a[b.colTag];return{sectorName:c||"Other",sortIndex:d}}function aggregateSector(a,b,c){for(var d={},e=1;e<b.length;e++)d[b[e].colTag]=_aggregateColumn(a,b[e],c);return d}function _resolveNumericSectorName(a,b){var c="",d="";if(a.groupByRange){for(var e=0;e<a.groupByRange.length;e++)if(b[a.colTag]<a.groupByRange[e]){c=a.text+" "+(0!=e?a.groupByRange[e-1]:0)+" - "+a.groupByRange[e],d=e;break}c||(c=a.text+" "+a.groupByRange[a.groupByRange.length-1]+"+",d=e+1)}else c=a.text;return{sectorName:c,sortIndex:d}}function _resolveAggregationMethod(a,b){var c="";if(a.aggregationMethod&&(c=a.aggregationMethod),a.conditionalAggregationMethod&&b&&1==b.length){var d=b[0].colTag;a.conditionalAggregationMethod[d]&&(c=a.conditionalAggregationMethod[d])}return c.toLowerCase()}function _aggregateColumn(a,b,c){var d,e=_resolveAggregationMethod(b,c);switch(e){case"sum":d=_straightSumAggregation({data:a,columnDef:b});break;case"average":d=_average({data:a,columnDef:b});break;case"count":d=_count({data:a,columnDef:b});break;case"count_distinct":d=_countDistinct({data:a,columnDef:b});break;case"count_and_distinct":d=_countAndDistinct({data:a,columnDef:b});break;case"most_data_points":d=_mostDataPoints({data:a,columnDef:b});break;default:d=""}return d}function _straightSumAggregation(a){for(var b=a.data,c=a.columnDef,d=0,e=0,f=0;f<b.length;f++)e=b[f][c.colTag]||0,d+=e;return d}function _average(a){return a.columnDef.weightBy?_weightedAverage(a):_simpleAverage(a)}function _simpleAverage(a){for(var b=_straightSumAggregation(a),c=0,d=0;d<a.data.length;d++)(a.data[d][a.columnDef.colTag]||0===a.data[d][a.columnDef.colTag])&&c++;return 0==c?"":b/c}function _weightedAverage(a){for(var b=a.data,c=a.columnDef,d=a.columnDef.weightBy,e=0,f=0;f<b.length;f++)e+=(b[f][c.colTag]||0)*(b[f][d.colTag]||0);var g=_straightSumAggregation({data:b,columnDef:d});return 0==g?0:e/g}function _count(a){a.data,a.columnDef;return a.data.length||0}function _countDistinct(a){var b,c,d=a.data,e=a.columnDef,f={};for(b=0;b<a.data.length;b++)d[b][e.colTag]&&(f[d[b][e.colTag]]=1);var g=0;for(c in f)f.hasOwnProperty(c)&&g++;return 1==g?d[0][e.colTag]:g}function _countAndDistinct(a){var b=_count(a),c=_countDistinct(a);return 1==b?c:"("+c+"/"+b+")"}function _mostDataPoints(a){for(var b={count:0,index:-1},c=0;c<a.data.length;c++){var d=Object.keys(a.data[c]).length;(d>b.count||d===b.count&&a.data[c].aggregationTiebreaker>a.data[b.index].aggregationTiebreaker)&&(b.count=d,b.index=c)}return-1==b.index?"":a.data[b.index][a.columnDef.colTag]}function exportToExcel(a,b){var c="<table><tr>";$.each(a.headers,function(a,b){c+="<td>"+parseString(b)+"</td>"}),c+="</tr>";var d=1;$.each(a.data,function(a,b){if(b.length>0&&"function"==typeof b[0].match&&b[0].match("Grand Total"))return void d++;c+="<tr>";var e=0;$.each(b,function(a,b){c+="<td>"+parseString(b)+"</td>",e++}),d++,c+="</tr>"}),c+="</table>";var e="<html xmlns:o='urn:schemas-microsoft-com:office:office' xmlns:x='urn:schemas-microsoft-com:office:excel' xmlns='http://www.w3.org/TR/REC-html40'>";e+="<head>",e+="<!--[if gte mso 9]>",e+="<xml>",e+="<x:ExcelWorkbook>",e+="<x:ExcelWorksheets>",e+="<x:ExcelWorksheet>",e+="<x:Name>",e+="{worksheet}",e+="</x:Name>",e+="<x:WorksheetOptions>",e+="<x:DisplayGridlines/>",e+="</x:WorksheetOptions>",e+="</x:ExcelWorksheet>",e+="</x:ExcelWorksheets>",e+="</x:ExcelWorkbook>",e+="</xml>",e+="<![endif]-->",e+="</head>",e+="<body>",e+=c,e+="</body>",e+="</html>";var f=window.navigator.userAgent,g=f.indexOf("MSIE ");if(g>0||navigator.userAgent.match(/Trident.*rv\:11\./)){var h=$("<iframe></iframe>").css("display","none").attr("id","ieExcelFrame").appendTo("body");ieExcelFrame.document.open("txt/html","replace"),ieExcelFrame.document.write(e),ieExcelFrame.document.close(),ieExcelFrame.focus(),ieExcelFrame.document.execCommand("SaveAs",!0,b+".xls"),h.remove()}else{var i="base64,"+$.base64.encode(e);$("<a></a>").attr("download",b).attr("href","data:application/vnd.ms-excel;filename="+b+".doc;"+i).append("<div id='download-me-now'></div>").appendTo("body"),$("#download-me-now").click().remove()}}function exportToPDF(a,b){var c={separator:",",ignoreColumn:[],tableName:"yourTableName",pdfFontSize:6,pdfLeftMargin:20},d=new jsPDF("l","pt","letter",!0),e=[],f=c.pdfLeftMargin;$.each(a.headers,function(a,b){var c=4.5*parseString(b,!0).length;(!e[a]||e[a]<c)&&(e[a]=Math.max(30,c))}),$.each(a.data,function(a,b){b.length>0&&"function"==typeof b[0].match&&b[0].match("Grand Total")||$.each(b,function(a,b){var c=4.5*parseString(b,!0).length;(!e[a]||e[a]<c)&&(e[a]=Math.max(30,c))})});var g=e.reduce(function(a,b){return a+b});if(g>752){var h=752/g;d.setFontSize(h*c.pdfFontSize);for(var i=0;i<e.length;i++)e[i]=e[i]*h}else d.setFontSize(c.pdfFontSize);$.each(a.headers,function(a,b){var c=e.reduce(function(b,c,d){return a>d?b+c:b},f);d.text(c,20,parseString(b,!0))});var j=20,k=1,l=0,m=1;$.each(a.data,function(a,b){b.length>0&&"function"==typeof b[0].match&&b[0].match("Grand Total")||(m++,m%50==0&&(d.addPage(),k++,m=1),l=j+10*m,$.each(b,function(a,b){var c=e.reduce(function(b,c,d){return a>d?b+c:b},f);d.text(c,l,parseString(b,!0))}))}),d.output("save",b+".pdf")}function parseString(a,b){if("string"!=typeof a){if(!a||!a.toString)return"";a=a.toString()}var c=a.trim();return c=c.replace(/[^\x00-\x7F]/g,""),b&&(c=c.substr(0,20)),c}function topPosition(a){return a?a.offsetTop+topPosition(a.offsetParent):0}function generateSectorKey(a){return null==a?"":a.join(SECTOR_SEPARATOR)}function generateRowKey(a,b){var c;return c=a.isDetail?b?a[b]:a.rowCount:generateSectorKey(a.sectorPath)}function rowMapper(a){var b=this.props.rowKey,c=generateRowKey(a,b);return Row({key:c,data:a,extraStyle:_getExtraStyle(c,this.state.extraStyle),isSelected:_isRowSelected(a,this.props.rowKey,this.state.selectedDetailRows,this.state.selectedSummaryRows),onSelect:this.handleSelect,onRightClick:this.props.onRightClick,toggleHide:this.handleToggleHide,columnDefs:this.state.columnDefs,filtering:this.props.filtering,handleColumnFilter:this.handleColumnFilter.bind})}function docClick(a){adjustHeaders.call(this),jQuery.isEmptyObject(this.state.filterInPlace)||$(a.target).hasClass("rt-header-element")||$(a.target).parent().hasClass("rt-header-element")||this.setState({filterInPlace:{}})}function adjustHeaders(a){var b=this.state.uniqueId;a>=0||(a=0);var c=0,d=$("#"+b+" .rt-headers-container"),e=parseInt(d.first().find(".rt-header-element").css("padding-left"));e+=parseInt(d.first().find(".rt-header-element").css("padding-right"));var f=!1;if(d.each(function(){var a=$(this),g=$("#"+b+" .rt-table tr:last td:eq("+c+")").outerWidth()-1;0==c&&1==parseInt(d.first().css("border-right"))&&(g+=1);var h=a.find(".rt-header-anchor-text").width()+e;a.width()>0&&h>a.width()+1&&(a.css("width",h+"px"),$("#"+b).find("tr").find("td:eq("+c+")").css("min-width",h+"px"),f=!0),g!==a.width()&&(a.width(g),f=!0),c++}),f){var g=d.find(".rt-downward-caret").removeClass("rt-downward-caret"),h=d.find(".rt-upward-caret").removeClass("rt-upward-caret");setTimeout(function(){g.addClass("rt-downward-caret"),h.addClass("rt-upward-caret")},0),5>=a&&adjustHeaders.call(this,++a)}}function bindHeadersToMenu(a){a.find(".rt-headers-container").each(function(){var a=this;$(a).hover(function(){var b=$(a).position();b.left&&$(a).find(".rt-header-menu").css("left",b.left+"px"),b.right&&$(a).find(".rt-header-menu").css("right",b.right+"px")})})}function uniqueId(a){var b=++idCounter+"";return a?a+b:b}function _isRowSelected(a,b,c,d){return null!=b?null!=c[a[b]]||!a.isDetail&&null!=d[generateSectorKey(a.sectorPath)]:void 0}function _getExtraStyle(a,b){return a&&b?b[a]:null}function _getPageArithmetics(a,b){var c={};if(a.props.disablePagination)c.lowerVisualBound=0,c.upperVisualBound=b.length;else{c.pageSize=a.props.pageSize||50,c.maxDisplayedPages=a.props.maxDisplayedPages||10,c.pageStart=1,c.pageEnd=Math.ceil(b.length/c.pageSize),c.allPages=[];for(var d=c.pageStart;d<=c.pageEnd;d++)c.allPages.push(d);c.pageDisplayRange=_computePageDisplayRange(a.state.currentPage,c.maxDisplayedPages),c.lowerVisualBound=(a.state.currentPage-1)*c.pageSize,c.upperVisualBound=Math.min(a.state.currentPage*c.pageSize-1,b.length)}return c}function _computePageDisplayRange(a,b){var c=b,d=Math.min(Math.floor(c/2),a-1),e=c-d;return{start:a-d-1,end:a+e-1}}function ReactTableGetInitialState(){var a=createTree(this.props),b=_getInitialSelections(this.props.selectedRows,this.props.selectedSummaryRows);return{rootNode:a,uniqueId:uniqueId("table"),currentPage:1,height:this.props.height,columnDefs:this.props.columnDefs,selectedDetailRows:b.selectedDetailRows,selectedSummaryRows:b.selectedSummaryRows,firstColumnLabel:_construct1StColumnLabel(this),extraStyle:{},rows:[],hasMoreRows:!1,itemsPerScroll:this.props.itemsPerScroll?this.props.itemsPerScroll:100,filterInPlace:{},currentFilters:[]}}function ReactTableHandleSelect(a){var b,c=this.props.rowKey;null!=c&&(null!=a.isDetail&1==a.isDetail?(b=this.toggleSelectDetailRow(a[c]),this.props.onSelectCallback(a,b)):(b=this.toggleSelectSummaryRow(generateSectorKey(a.sectorPath)),this.props.onSummarySelectCallback(a,b)))}function ReactTableHandleColumnFilter(a,b,c){"boolean"!=typeof c&&(c=void 0);var d=b.target?b.target.value||b.target.textContent:b,e=!(this.props.filtering&&this.props.filtering.caseSensitive===!1);if(!c)for(var f=0;f<this.state.currentFilters.length;f++)if(this.state.currentFilters[f].colDef===a){this.state.currentFilters.splice(f,1),this.handleClearFilter(a,!0);break}this.state.rootNode.filterByColumn(a,d,e),c||(this.state.currentFilters.push({colDef:a,filterText:d}),$("input.rt-"+a.colTag+"-filter-input").val(d),this.setState({rootNode:this.state.rootNode,currentFilters:this.state.currentFilters}))}function ReactTableHandleRemoveFilter(a,b){"boolean"!=typeof b&&(b=void 0);for(var c=0;c<this.state.rootNode.ultimateChildren.length;c++)this.state.rootNode.ultimateChildren[c].hiddenByFilter=!1;for(c=0;c<this.state.currentFilters.length;c++)if(this.state.currentFilters[c].colDef===a){this.state.currentFilters.splice(c,1);break}for(c=0;c<this.state.currentFilters.length;c++)this.handleColumnFilter(this.state.currentFilters[c].colDef,this.state.currentFilters[c].filterText,!0);if(!b){var d=this.state.filterInPlace;delete d[a.colTag],this.setState({filterInPlace:d,rootNode:this.state.rootNode,currentFilters:this.state.currentFilters}),$("input.rt-"+a.colTag+"-filter-input").val("")}}function ReactTableHandleRemoveAllFilters(){recursivelyClearFilters(this.state.rootNode),this.setState({filterInPlace:{},rootNode:this.state.rootNode,currentFilters:[]}),$("input.rt-filter-input").val("")}function recursivelyClearFilters(a){a.clearFilter();for(var b=0;b<a.children.length;b++)recursivelyClearFilters(a.children[b]);if(!a.hasChild())for(var b=0;b<a.ultimateChildren.length;b++)a.ultimateChildren[b].hiddenByFilter=!1}function reApplyAllFilters(){for(var a=0;a<this.state.currentFilters.length;a++)this.handleColumnFilter(this.state.currentFilters[a].colDef,this.state.currentFilters[a].filterText,!0);this.setState({rootNode:this.state.rootNode})}function ReactTableHandleSort(a,b){var c=getSortFunction(a).bind(a),d=getReverseSortFunction(a).bind(a);this.state.rootNode.sortChildren({sortFn:c,reverseSortFn:d,recursive:!0,sortAsc:b}),this.props.currentSortStates=[b?c:d],this.setState({rootNode:this.state.rootNode,sortAsc:b,columnDefSorted:a,filterInPlace:{}})}function ReactTableHandleAddSort(a,b){if(!this.props.currentSortStates||0==this.props.currentSortStates.length)return void this.handleSort(a,b);var c=getSortFunction(a).bind(a),d=getReverseSortFunction(a).bind(a);this.state.rootNode.addSortToChildren({sortFn:c,reverseSortFn:d,recursive:!0,sortAsc:b,oldSortFns:this.props.currentSortStates}),this.props.currentSortStates.push(b?c:d),this.setState({rootNode:this.state.rootNode,sortAsc:b,columnDefSorted:a,filterInPlace:{}})}function ReactTableHandleGroupBy(a,b){null!=b&&""!=b&&a&&(a.groupByRange=_createFloatBuckets(b)),null!=a?(this.props.groupBy=this.props.groupBy||[],this.props.groupBy.push(a)):this.props.groupBy=null,this.state.rootNode=createTree(this.props),this.state.currentFilters.length>0&&reApplyAllFilters.call(this),this.setState({rootNode:this.state.rootNode,currentPage:1,firstColumnLabel:_construct1StColumnLabel(this)})}function ReactTableHandleAdd(){this.props.beforeColumnAdd&&this.props.beforeColumnAdd(this)}function ReactTableHandleRemove(a){for(var b=this.state.columnDefs.indexOf(a),c=[],d=0;d<this.state.columnDefs.length;d++)d!=b&&c.push(this.state.columnDefs[d]);this.setState({columnDefs:c}),null!=this.props.afterColumnRemove&&this.props.afterColumnRemove(c,a)}function ReactTableHandleToggleHide(a,b){b.stopPropagation(),a.treeNode.collapsed=!a.treeNode.collapsed,this.setState({rootNode:this.state.rootNode})}function ReactTableHandlePageClick(a){this.setState({currentPage:a})}function _createFloatBuckets(a){var b,c=0,d=[];for(b=a.split(","),c=0;c<b.length;c++){var e=parseFloat(b[c]);isNaN(e)||d.push(e),d.sort(function(a,b){return a-b})}return d}function _construct1StColumnLabel(a){var b=[];if(a.props.groupBy)for(var c=0;c<a.props.groupBy.length;c++)b.push(a.props.groupBy[c].text);return b.push(a.props.columnDefs[0].text),b}function _getInitialSelections(a,b){var c={selectedDetailRows:{},selectedSummaryRows:{}};if(null!=a)for(var d=0;d<a.length;d++)c.selectedDetailRows[a[d]]=1;if(null!=b)for(var d=0;d<b.length;d++)c.selectedSummaryRows[b[d]]=1;return c}function genericValueBasedSorter(a,b){var c=0;return a[this.colTag]||0===a[this.colTag]&&!this.formatConfig.showZeroAsBlank||!b[this.colTag]?!a[this.colTag]||b[this.colTag]||0===b[this.colTag]&&!this.formatConfig.showZeroAsBlank?a[this.colTag]<b[this.colTag]?c=-1:a[this.colTag]>b[this.colTag]&&(c=1):c=-1:c=1,c}function genericValueBasedReverseSorter(a,b){var c=0;return a[this.colTag]||0===a[this.colTag]&&!this.formatConfig.showZeroAsBlank||!b[this.colTag]?!a[this.colTag]||b[this.colTag]||0===b[this.colTag]&&!this.formatConfig.showZeroAsBlank?a[this.colTag]<b[this.colTag]?c=1:a[this.colTag]>b[this.colTag]&&(c=-1):c=-1:c=1,c}function dateDetailSort(a,b){var c=new Date(a[this.colTag])-new Date(b[this.colTag]);return c}function dateDetailReverseSort(a,b){var c=new Date(b[this.colTag])-new Date(a[this.colTag]);return c}function getSortFunction(a){var b=a.format||"";if(a.sort)return a.sort;switch(b.toLowerCase()){case"date":return dateDetailSort;default:return genericValueBasedSorter}}function getReverseSortFunction(a){var b=a.format||"";if(a.reverseSort)return a.reverseSort;if(a.sort)return function(b,c){return-1*a.sort.bind(this)(b,c)};if(!a.sort)switch(b.toLowerCase()){case"date":return dateDetailReverseSort;default:return genericValueBasedReverseSorter}}function createTree(a){if(null!=a.rootNode)return a.rootNode;var b=buildTreeSkeleton(a);return recursivelyAggregateNodes(b,a),b.sortRecursivelyBySortIndex(),b.foldSubTree(),b}function buildTreeSkeleton(a){var b,c=new TreeNode("Grand Total",null),d=a.data;for(a.disableGrandTotal&&(c.display=!1),b=0;b<d.length;b++)c.appendUltimateChild(d[b]),_populateChildNodesForRow(c,d[b],a.groupBy);return c}function recursivelyAggregateNodes(a,b){if(a.rowData=aggregateSector(a.ultimateChildren,b.columnDefs,b.groupBy),a.children.length>0)for(var c=0;c<a.children.length;c++)recursivelyAggregateNodes(a.children[c],b)}function _populateChildNodesForRow(a,b,c){var d,e=a;if(null!=c&&0!=c.length)for(d=0;d<c.length;d++){var f=getSectorName(b,c[d]);e=e.appendRowToChildren({childSectorName:f.sectorName,childRow:b,sortIndex:f.sortIndex,groupByColumnDef:c[d]})}}function TreeNode(a,b){this.sectorTitle=a,this.parent=b,this.groupByColumnDef={},this.rowData=null,this.display=!0,this.children=[],this.ultimateChildren=[],this.collapsed=null!=this.parent,this.sortIndex=null,this.hiddenByFilter=!1,this._childrenSectorNameMap={}}function _hasSortIndex(a){return null!=a&&null!=a.sortIndex&&!isNaN(a.sortIndex)}function rasterizeTree(a){var b=a.node,c=a.firstColumn;b=_decorateRowData(b,c);var d=0==b.display?[]:[b.rowData];return b.collapsed||(b.children.length>0?_rasterizeChildren(d,a):_rasterizeDetailRows(b,d)),d}function _rasterizeChildren(a,b){var c,d,e,f=b.node,g=b.firstColumn;for(c=0;c<f.children.length;c++)for(e=rasterizeTree({node:f.children[c],firstColumn:g}),d=0;d<e.length;d++)e[d].treeNode&&e[d].treeNode.hiddenByFilter||a.push(e[d])}function _rasterizeDetailRows(a,b){for(var c=0;c<a.ultimateChildren.length;c++){var d=a.ultimateChildren[c];d.hiddenByFilter||(d.sectorPath=a.rowData.sectorPath,d.isDetail=!0,b.push(d))}}function _decorateRowData(a,b){return a.rowData.sectorPath=a.getSectorPath(),a.rowData[b.colTag]=a.sectorTitle,a.rowData.treeNode=a,a}var InfiniteScroll=React.createClass({displayName:"InfiniteScroll",propTypes:{pageStart:React.PropTypes.number,threshold:React.PropTypes.number,loadMore:React.PropTypes.func.isRequired,hasMore:React.PropTypes.bool},getDefaultProps:function(){return{pageStart:0,hasMore:!1,threshold:250}},componentDidMount:function(){this.pageLoaded=this.props.pageStart,this.attachScrollListener()},componentDidUpdate:function(){this.attachScrollListener()},render:function(){var a=this.props;return React.DOM.div(null,a.children,a.hasMore&&(a.loader||InfiniteScroll._defaultLoader))},scrollListener:function(){var a=this.getDOMNode(),b=void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop;topPosition(a)+a.offsetHeight-b-window.innerHeight<Number(this.props.threshold)&&(this.detachScrollListener(),this.props.loadMore(this.pageLoaded+=1))},attachScrollListener:function(){this.props.hasMore&&(window.addEventListener("scroll",this.scrollListener),window.addEventListener("resize",this.scrollListener),this.scrollListener())},detachScrollListener:function(){window.removeEventListener("scroll",this.scrollListener),window.removeEventListener("resize",this.scrollListener)},componentWillUnmount:function(){this.detachScrollListener()}});InfiniteScroll.setDefaultLoader=function(a){InfiniteScroll._defaultLoader=a};var idCounter=0,SECTOR_SEPARATOR="#",ReactTable=React.createClass({displayName:"ReactTable",getInitialState:ReactTableGetInitialState,handleSort:ReactTableHandleSort,handleAddSort:ReactTableHandleAddSort,handleColumnFilter:ReactTableHandleColumnFilter,handleClearFilter:ReactTableHandleRemoveFilter,handleClearAllFilters:ReactTableHandleRemoveAllFilters,handleAdd:ReactTableHandleAdd,handleRemove:ReactTableHandleRemove,handleToggleHide:ReactTableHandleToggleHide,handleGroupBy:ReactTableHandleGroupBy,handlePageClick:ReactTableHandlePageClick,handleSelect:ReactTableHandleSelect,handleCollapseAll:function(){var a=this.state.rootNode;a.collapseImmediateChildren(),this.setState({rootNode:a,currentPage:1})},handleExpandAll:function(){var a=this.state.rootNode;a.expandRecursively(),this.setState({rootNode:a,currentPage:1})},handleDownload:function(a){var b=this,c={headers:[],data:[]},d=this.state.columnDefs[0],e=rasterizeTree({node:this.state.rootNode,firstColumn:d,selectedDetailRows:this.state.selectedDetailRows});$.each(this.props.columnDefs,function(){c.headers.push(this.text)}),$.each(e,function(){if("Grand Total"!==this[d.colTag]){var a=[],e=this;$.each(b.props.columnDefs,function(){a.push(buildCellLookAndFeel(this,e).value)}),c.data.push(a)}}),"excel"===a?exportToExcel(c,this.props.filenameToSaveAs?this.props.filenameToSaveAs:"table-export"):"pdf"===a&&exportToPDF(c,this.props.filenameToSaveAs?this.props.filenameToSaveAs:"table-export")},toggleSelectDetailRow:function(a){var b,c=this.state.selectedDetailRows;return null!=c[a]?(delete c[a],b=!1):(c[a]=1,b=!0),this.setState({selectedDetailRows:c}),b},toggleSelectSummaryRow:function(a){var b,c=this.state.selectedSummaryRows;return null!=c[a]?(delete c[a],b=!1):(c[a]=1,b=!0),this.setState({selectedSummaryRows:c}),b},getDetailToggleState:function(a){return this.state.selectedDetailRows[a]&&!0},clearAllRowSelections:function(){this.setState({selectedDetailRows:{},selectedSummaryRows:{}})},getRowSelectionStates:function(){return{selectedDetailRows:this.state.selectedDetailRows,selectedSummaryRows:this.state.selectedSummaryRows}},addColumn:function(a,b){for(var c=!1,d=0;d<this.state.columnDefs.length;d++)if(this.state.columnDefs[d].colTag==a.colTag){this.state.columnDefs[d]=a,c=!0;break}c||this.state.columnDefs.push(a),b?(this.props.data=b,this.state.rootNode=createTree(this.props)):recursivelyAggregateNodes(this.state.rootNode,this.props),this.setState({rootNode:this.state.rootNode})},redoPresort:function(){if(this.props.presort){var a;for(var b in this.props.presort)for(var c=0;c<this.props.columnDefs.length;c++)if(this.props.columnDefs[c].colTag===b){a=this.props.columnDefs[c],"asc"===this.props.presort[b]?this.handleSort(a,!0):"desc"===this.props.presort[b]&&this.handleSort(a,!1);break}}},replaceData:function(a,b){this.props.data=a;var c=createTree(this.props);this.setState({rootNode:c,currentPage:1,sortAsc:void 0,columnDefSorted:void 0,filterInPlace:{}}),this.props.currentSortStates=[];var d=this;b||setTimeout(function(){d.redoPresort()})},setStyleByKey:function(a,b){this.state.extraStyle[a]=b,this.setState({extraStyle:this.state.extraStyle})},handleScroll:function(a){var b=$(a.target),c=b.scrollTop(),d=b.height(),e=b.find("tbody").height();c/(e-d)>.8&&this.setState({rows:this.addMoreRows(!0)})},componentDidMount:function(){$(this.getDOMNode()).find(".rt-scrollable").get(0).addEventListener("scroll",this.handleScroll),setTimeout(function(){adjustHeaders.call(this)}.bind(this),0),setTimeout(function(){adjustHeaders.call(this)}.bind(this),500),document.addEventListener("click",docClick.bind(this)),window.addEventListener("resize",adjustHeaders.bind(this));var a=$(this.getDOMNode());a.find(".rt-scrollable").bind("scroll",function(){a.find(".rt-headers").css({overflow:"auto"}).scrollLeft($(this).scrollLeft()),a.find(".rt-headers").css({overflow:"hidden"})}),bindHeadersToMenu(a);var b=this;setTimeout(function(){b.redoPresort()})},componentWillMount:function(){},componentWillUnmount:function(){window.removeEventListener("resize",adjustHeaders.bind(this)),$(this.getDOMNode()).find(".rt-scrollable").get(0).removeEventListener("scroll",this.handleScroll)},componentDidUpdate:function(){adjustHeaders.call(this),bindHeadersToMenu($(this.getDOMNode()))},addMoreRows:function(a){if(this.props.justAdded)return this.props.justAdded=!1,this.state.rows;var b=rasterizeTree({node:this.state.rootNode,firstColumn:this.state.columnDefs[0],selectedDetailRows:this.state.selectedDetailRows});this.props.rowMultiplier=a?void 0===this.props.rowMultiplier?0:this.props.rowMultiplier+1:this.props.rowMultiplier?this.props.rowMultiplier:0;var c=(this.props.rowMultiplier+1)*this.state.itemsPerScroll,d=[];if(a&&this.state.rows.length<c&&this.state.rows.length<b.length){var e=this.state.rows.length;return d=b.slice(e,c),this.props.justAdded=!0,this.state.rows.concat(d.map(rowMapper,this))}return d=b.slice(0,c),d.map(rowMapper,this)},render:function(){var a=rasterizeTree({node:this.state.rootNode,firstColumn:this.state.columnDefs[0],selectedDetailRows:this.state.selectedDetailRows}),b=_getPageArithmetics(this,a);if(this.props.disableInfiniteScrolling){var c=a.slice(b.lowerVisualBound,b.upperVisualBound+1);this.state.rows=c.map(rowMapper,this)}else this.state.rows=this.addMoreRows();var d=buildHeaders(this),e=buildFooter(this,b),f={};return this.state.height&&parseInt(this.state.height)>0&&(f.height=this.state.height),this.props.disableScrolling&&(f.overflowY="hidden"),React.DOM.div({id:this.state.uniqueId,className:"rt-table-container"},d,React.DOM.div({style:f,className:"rt-scrollable"},InfiniteScroll({loadMore:this.addMoreRows,hasMore:this.state.hasMore},React.DOM.table({className:"rt-table"},React.DOM.tbody(null,this.state.rows)))),this.props.disableInfiniteScrolling?e:null)
}}),Row=React.createClass({displayName:"Row",render:function(){for(var a=[buildFirstCellForRow.call(this)],b=1;b<this.props.columnDefs.length;b++){var c=this.props.columnDefs[b],d=buildCellLookAndFeel(c,this.props.data),e=React.addons.classSet,f=e(d.classes),g=d.value;c&&c.format&&"date"===c.format.toLowerCase()&&(isNaN(g)||(g=new Date(g).toLocaleDateString())),c.cellTemplate&&(g=c.cellTemplate.call(this,this.props.data,c,g)),a.push(React.DOM.td({className:f,onClick:c.onCellSelect?c.onCellSelect.bind(this,this.props.data[c.colTag],c,b):null,onContextMenu:this.props.onRightClick?this.props.onRightClick.bind(null,this.props.data,c):null,style:d.styles,key:c.colTag,onDoubleClick:this.props.filtering&&this.props.filtering.doubleClickCell?this.props.handleColumnFilter(null,c):null},g))}var e=React.addons.classSet,f=e({selected:this.props.isSelected&&this.props.data.isDetail,"summary-selected":this.props.isSelected&&!this.props.data.isDetail}),h={cursor:"pointer"};for(var i in this.props.extraStyle)h[i]=this.props.extraStyle[i];return React.DOM.tr({onClick:this.props.onSelect.bind(null,this.props.data),className:f,style:h},a)}}),PageNavigator=React.createClass({displayName:"PageNavigator",handleClick:function(a,b){b.preventDefault(),a<=this.props.numPages&&a>=1&&this.props.handleClick(a)},render:function(){var a=this,b=React.addons.classSet,c=b({disabled:1==this.props.activeItem}),d=b({disabled:this.props.activeItem==this.props.numPages}),e=this.props.items.map(function(b){return React.DOM.li({key:b,className:a.props.activeItem==b?"active":""},React.DOM.a({onClick:a.handleClick.bind(null,b)},b))});return React.DOM.ul({className:c,className:"pagination pull-right"},React.DOM.li({className:d},React.DOM.a({className:c,onClick:this.props.handleClick.bind(null,this.props.activeItem-1)},"«")),e,React.DOM.li({className:d},React.DOM.a({className:d,onClick:this.props.handleClick.bind(null,this.props.activeItem+1)},"»")))}}),SummarizeControl=React.createClass({displayName:"SummarizeControl",getInitialState:function(){return{userInputBuckets:""}},handleChange:function(a){this.setState({userInputBuckets:a.target.value})},handleKeyPress:function(a){13==a.charCode&&(a.preventDefault(),this.props.table.handleGroupBy(this.props.columnDef,this.state.userInputBuckets))},handleClick:function(){var a=$(this.getDOMNode());a.children(".menu-item-input").children("input").focus()},render:function(){var a=this.props.table,b=this.props.columnDef,c="number"==b.format||"currency"==b.format?React.DOM.div({className:"menu-item-input",style:{position:"absolute",top:"-50%",right:"100%"}},React.DOM.label({style:{display:"block"}},"Enter Bucket(s)"),React.DOM.input({tabIndex:"1",onKeyPress:this.handleKeyPress,onChange:this.handleChange,placeholder:"ex: 1,10,15"}),React.DOM.a({tabIndex:"2",style:{display:"block"},onClick:a.handleGroupBy.bind(null,b,this.state.userInputBuckets),className:"btn-link"},"Ok")):null;return React.DOM.div({onClick:null==c?a.handleGroupBy.bind(null,b,null):this.handleClick,style:{position:"relative"},className:"menu-item menu-item-hoverable"},React.DOM.div(null,"Summarize"),c)}});TreeNode.prototype.appendUltimateChild=function(a){this.ultimateChildren.push(a)},TreeNode.prototype.collapseImmediateChildren=function(){for(var a=0;a<this.children.length;a++)this.children[a].collapsed=!0},TreeNode.prototype.foldSubTree=function(){for(var a=0;a<this.children.length;a++)this.children[a].collapsed=this.children[a].hasChild()?!1:!0,this.children[a].foldSubTree()},TreeNode.prototype.hasChild=function(){return this.children.length>0},TreeNode.prototype.expandRecursively=function(){var a;for(a=0;a<this.children.length;a++)this.children[a].collapsed=!1,this.children[a].expandRecursively()},TreeNode.prototype.appendRowToChildren=function(a){var b=a.childSectorName,c=a.childRow,d=a.sortIndex,e=a.groupByColumnDef;if(null==this._childrenSectorNameMap[b]){var f=new TreeNode(b,this);f.sortIndex=d,f.groupByColumnDef=e,this.children.push(f),this._childrenSectorNameMap[b]=f}return c&&this._childrenSectorNameMap[b].appendUltimateChild(c),this._childrenSectorNameMap[b]},TreeNode.prototype.getSectorPath=function(){for(var a=[this.sectorTitle],b=this.parent;null!=b;)a.unshift(b.sectorTitle),b=b.parent;return a},TreeNode.prototype.sortChildren=function(a){var b=a.sortFn,c=a.reverseSortFn,d=a.recursive,e=a.sortAsc,f=1==e?1:-1;if(this.children.sort(function(a,d){var e=a.rowData,g=d.rowData;return c&&1!==f?c(e,g):f*b(e,g)}),this.hasChild()||this.ultimateChildren.sort(function(a,d){return c&&1!==f?c(a,d):f*b(a,d)}),d)for(var g=0;g<this.children.length;g++)this.children[g].sortChildren({sortFn:b,reverseSortFn:a.reverseSortFn,recursive:d,sortAsc:e})},TreeNode.prototype.addSortToChildren=function(a){function b(a,b,g,h){0==j.length&&j.push($.extend({},a[b]));for(var k=!0,l=0;l<f.length;l++)if(0!==f[l](c(a[b],g),c(a[b+1],g))){k=!1;break}if(k&&!h)j.push($.extend({},a[b+1]));else if(j.length>1){h&&j.push($.extend({},a[b+1])),j.sort(function(a,b){return e&&1!==i?e(c(a,g),c(b,g)):i*d(c(a,g),c(b,g))});for(var m=0;m<j.length;m++){var n=b+m+1-j.length;a[n]=j[m]}j=[]}else j=[]}function c(a,b){return b?a.rowData:a}for(var d=a.sortFn,e=a.reverseSortFn,f=a.oldSortFns,g=a.recursive,h=a.sortAsc,i=1==h?1:-1,j=[],k=0;k+1<this.children.length;k++)b(this.children,k,!0,k+2>=this.children.length);if(!this.hasChild())for(var k=0;k+1<this.ultimateChildren.length;k++)b(this.ultimateChildren,k,!1,k+2>=this.ultimateChildren.length);if(g)for(var k=0;k<this.children.length;k++)this.children[k].addSortToChildren(a)},TreeNode.prototype.filterByColumn=function(a,b,c){for(var d=0;d<this.children.length;d++){this.children[d].filterByColumn(a,b,c);for(var e=!0,f=0;f<this.children[d].ultimateChildren.length;f++)if(!this.children[d].ultimateChildren[f].hiddenByFilter){e=!1;break}this.children[d].hiddenByFilter=e}if(!this.hasChild())for(var d=0;d<this.ultimateChildren.length;d++){var g=this.ultimateChildren[d],h={};h[a.colTag]=g[a.colTag],g.hiddenByFilter=c?g.hiddenByFilter||-1===buildCellLookAndFeel(a,h).value.toString().search(b):g.hiddenByFilter||-1===buildCellLookAndFeel(a,h).value.toString().toUpperCase().search(b.toUpperCase())}},TreeNode.prototype.clearFilter=function(){this.hiddenByFilter=!1},TreeNode.prototype.sortRecursivelyBySortIndex=function(){this.hasChild()&&_hasSortIndex(this.children[0])&&this.children.sort(function(a,b){return _hasSortIndex(a)&&_hasSortIndex(b)?a.sortIndex-b.sortIndex:0});for(var a=0;a<this.children.length;a++)this.children[a].sortRecursivelyBySortIndex()};