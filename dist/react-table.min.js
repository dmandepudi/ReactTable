/*! react-table 31-10-2014 Author: Erfang Chen */
function groupData(data,groupBy,columnDefs){var bucketResults=buildDataBuckets(data,groupBy),aggregationResults=aggregateBuckets(bucketResults,columnDefs);return aggregationResults.concat(data)}function straightSumAggregation(options){for(var data=options.data,columnDef=options.columnDef,result=0,i=0;i<data.length;i++)result+=data[i][columnDef.colTag];return result}function average(options){return options.columnDef.weightBy?weightedAverage(options):simpleAverage(options)}function simpleAverage(options){return straightSumAggregation(options)/options.data.length}function weightedAverage(options){for(var data=options.data,columnDef=options.columnDef,weightBy=options.columnDef.weightBy,sumProduct=0,i=0;i<data.length;i++)sumProduct+=data[i][columnDef.colTag]*data[i][weightBy.colTag];var weightSum=straightSumAggregation({data:data,columnDef:weightBy});return sumProduct/weightSum}function count(options){options.data,options.columnDef}function countDistinct(options){options.data,options.columnDef}function extractSectors(row,groupBy){for(var results=[],i=0;i<groupBy.length;i++)results.push(row[groupBy[i].colTag]);return results}function buildDataBuckets(data,groupBy){for(var results={},i=0;i<data.length;i++){var sectorPath=extractSectors(data[i],groupBy);data[i].sectorPath=sectorPath,data[i].isDetail=!0;for(var j=0;j<sectorPath.length;j++){var subSectorPath=sectorPath.slice(0,j+1),subSectorKey=generateSectorKey(subSectorPath);results[subSectorKey]||(results[subSectorKey]={data:[],sectorPath:subSectorPath}),results[subSectorKey].data.push(data[i])}}return results}function aggregateBuckets(bucketResults,columnDefs){var result=[];for(var sectorKey in bucketResults)if(bucketResults.hasOwnProperty(sectorKey)){var singleSectorResult=aggregateSector(bucketResults[sectorKey],columnDefs);result.push(singleSectorResult)}return result}function aggregateSector(bucketResult,columnDefs){var result={};result.sectorPath=bucketResult.sectorPath,result[columnDefs[0].colTag]=bucketResult.sectorPath[bucketResult.sectorPath.length-1];for(var i=1;i<columnDefs.length;i++)result[columnDefs[i].colTag]=aggregateColumn(bucketResult,columnDefs[i]);return result}function aggregateColumn(bucketResult,columnDef){var result;switch(columnDef.aggregationMethod){case"SUM":result=straightSumAggregation({data:bucketResult.data,columnDef:columnDef});break;case"AVERAGE":result=average({data:bucketResult.data,columnDef:columnDef});break;default:result=""}return result}function buildHeaders(table){var headerColumns=table.state.columnDefs.map(function(columnDef){var styles={textAlign:"number"==columnDef.format?"right":"left"};return React.createElement("th",{style:styles,key:columnDef.colTag},React.createElement("a",{className:"btn-link",onClick:table.handleSort.bind(table,columnDef)},columnDef.text),React.createElement("a",{className:"btn-link",onClick:table.handleRemove.bind(table,columnDef)},React.createElement("span",null,React.createElement("strong",null,"-"))))});return headerColumns.push(React.createElement("th",{style:{textAlign:"center"}},React.createElement("a",{className:"btn-link",onClick:table.handleAdd},React.createElement("strong",null,"+")))),React.createElement("thead",null,React.createElement("tr",{key:"header"},headerColumns))}function buildFirstCellForRow(props){var data=props.data,columnDef=props.columnDefs[0],toggleHide=props.toggleHide,firstColTag=columnDef.colTag;if(!data.sectorPath)return React.createElement("td",{key:firstColTag},data[firstColTag]);var identLevel=data.isDetail?data.sectorPath.length:data.sectorPath.length-1,firstCellStyle={paddingLeft:10+25*identLevel+"px",borderRight:"1px #ddd solid"};if(data.isDetail)var result=React.createElement("td",{style:firstCellStyle,key:firstColTag},data[firstColTag]);else result=React.createElement("td",{style:firstCellStyle,key:firstColTag},React.createElement("a",{onClick:toggleHide.bind(null,data),className:"btn-link"},React.createElement("strong",null,data[firstColTag])));return result}function buildFooter(table,paginationAttr){return table.props.columnDefs.length>0?React.createElement(PageNavigator,{items:paginationAttr.allPages.slice(paginationAttr.pageDisplayRange.start,paginationAttr.pageDisplayRange.end),activeItem:table.state.currentPage,numPages:paginationAttr.pageEnd,handleClick:table.handlePageClick}):null}function getPageArithmetics(table,data){var result={};result.pageSize=table.props.pageSize||50,result.maxDisplayedPages=table.props.maxDisplayedPages||10,result.pageStart=1,result.pageEnd=Math.ceil(data.length/result.pageSize),result.allPages=[];for(var i=result.pageStart;i<=result.pageEnd;i++)result.allPages.push(i);return result.pageDisplayRange=computePageDisplayRange(table.state.currentPage,result.maxDisplayedPages),result.lowerVisualBound=(table.state.currentPage-1)*result.pageSize,result.upperVisualBound=Math.min(table.state.currentPage*result.pageSize-1,data.length),result}function shouldHide(data,collapsedSectorPaths,collapsedSectorKeys){var result=!1,hasCollapsedAncestor=areAncestorsCollapsed(data.sectorPath,collapsedSectorPaths,collapsedSectorKeys),isSummaryRow=!data.isDetail,immediateSectorCollapsed=null!=collapsedSectorPaths[generateSectorKey(data.sectorPath)];return hasCollapsedAncestor?result=!0:immediateSectorCollapsed&&!isSummaryRow&&(result=!0),result}function areAncestorsCollapsed(sectorPath,collapsedSectorPaths,collapsedSectorKeys){for(var result=!1,max=collapsedSectorKeys.length,i=0;max>i;i++)isSubSectorOf(sectorPath,collapsedSectorPaths[collapsedSectorKeys[i]])&&(result=!0);return result}function isSubSectorOf(subSectorCandidate,superSectorCandidate){if(subSectorCandidate.length<=superSectorCandidate.length)return!1;for(var i=0;i<superSectorCandidate.length;i++)if(subSectorCandidate[i]!=superSectorCandidate[i])return!1;return!0}function generateRowKey(row,rowKey){var key;if(rowKey)key=row[rowKey];else{key=generateSectorKey(row.sectorPath);for(var prop in row)row.hasOwnProperty(prop)&&(key+=prop+"="+row[prop]+";")}return key}function generateSectorKey(sectorPath){return sectorPath?sectorPath.join(SECTOR_SEPARATOR):""}function prepareTableData(props){var data=deepCopyData(props.data);if(props.groupBy){data=groupData(data,props.groupBy,props.columnDefs);var sortOptions={sectorSorter:defaultSectorSorter,detailSorter:defaultDetailSorter};data.sort(sorterFactory.call(this,sortOptions))}return data}function deepCopyData(data){return data.map(function(row){var copy={};for(var prop in row)row.hasOwnProperty(prop)&&(copy[prop]=row[prop]);return copy.isDetail=!0,copy})}function getInitiallyCollapsedSectorPaths(data){var result={};return data.map(function(row){if(row.sectorPath&&row.isDetail){var sectorPathKey=generateSectorKey(row.sectorPath);result[sectorPathKey]||(result[sectorPathKey]=row.sectorPath)}}),result}function getInitiallySelectedRows(selectedRows){var result={};selectedRows=selectedRows||[];for(var i=0;i<selectedRows.length;i++)result[selectedRows[i]]=1;return result}function computePageDisplayRange(currentPage,maxDisplayedPages){var displayUnitsLeft=maxDisplayedPages,leftAllocation=Math.min(Math.floor(displayUnitsLeft/2),currentPage-1),rightAllocation=displayUnitsLeft-leftAllocation;return{start:currentPage-leftAllocation-1,end:currentPage+rightAllocation-1}}function ReactTabeGetInitialState(){var data=prepareTableData.call(this,this.props),collapsedSectorPaths=getInitiallyCollapsedSectorPaths(data),collapsedSectorKeys=[];for(var key in collapsedSectorPaths)collapsedSectorPaths.hasOwnProperty(key)&&collapsedSectorKeys.push(key);var selectedRows=getInitiallySelectedRows(this.props.selectedRows);return{currentPage:1,data:data,columnDefs:this.props.columnDefs,collapsedSectorPaths:collapsedSectorPaths,collapsedSectorKeys:collapsedSectorKeys,selectedRows:selectedRows}}function ReactTableHandleSort(columnDefToSortBy){var data=this.state.data,sortOptions={sectorSorter:defaultSectorSorter,detailSorter:getSortFunction(columnDefToSortBy),sortDetailBy:columnDefToSortBy};data.sort(sorterFactory.call(this,sortOptions)),columnDefToSortBy.asc=!columnDefToSortBy.asc,this.setState({data:data})}function ReactTableHandleAdd(){this.props.beforeColumnAdd&&this.props.beforeColumnAdd()}function ReactTableHandleRemove(columnDefToRemove){for(var loc=this.state.columnDefs.indexOf(columnDefToRemove),newColumnDefs=[],i=0;i<this.state.columnDefs.length;i++)i!=loc&&newColumnDefs.push(this.state.columnDefs[i]);this.setState({columnDefs:newColumnDefs}),null!=this.props.afterColumnRemove&&this.props.afterColumnRemove(newColumnDefs,columnDefToRemove)}function ReactTableHandleToggleHide(summaryRow){var sectorKey=generateSectorKey(summaryRow.sectorPath);null==this.state.collapsedSectorPaths[sectorKey]?(this.state.collapsedSectorPaths[sectorKey]=summaryRow.sectorPath,this.state.collapsedSectorKeys.push(sectorKey)):(delete this.state.collapsedSectorPaths[sectorKey],this.state.collapsedSectorKeys.splice(this.state.collapsedSectorKeys.indexOf(sectorKey),1)),this.setState({collapsedSectorPaths:this.state.collapsedSectorPaths,collapsedSectorKeys:this.state.collapsedSectorKeys})}function ReactTableHandleRowSelect(row){var rowKey=this.props.rowKey;if(rowKey&&row.isDetail){this.props.onSelectCallback&&this.props.onSelectCallback.call(this,row);var selectedRows=this.state.selectedRows;selectedRows[row[rowKey]]?delete selectedRows[row[rowKey]]:selectedRows[row[rowKey]]=1,this.setState({selectedRows:selectedRows})}}function ReactTableHandlePageClick(page){var pageSize=this.props.pageSize||10,maxPage=Math.ceil(this.state.data.length/pageSize);1>page||page>maxPage||this.setState({currentPage:page})}function sorterFactory(options){var sectorSorter=options.sectorSorter,detailSorter=options.detailSorter,sortSummaryBy=options.sortSummaryBy,sortDetailBy=options.sortDetailBy;return function(a,b){var result=0;return result=sectorSorter.call(sortSummaryBy,a,b),0==result&&(result=a.isDetail&&!b.isDetail?1:b.isDetail&&!a.isDetail?-1:0,0==result&&(result=detailSorter.call(sortDetailBy,a,b))),result}.bind(this)}function defaultSectorSorter(a,b){return generateSectorKey(a.sectorPath).localeCompare(generateSectorKey(b.sectorPath))}function defaultDetailSorter(a,b){return generateRowKey(a).localeCompare(generateRowKey(b))}function genericDetailSort(a,b){var returnValue=0;return a[this.colTag]<b[this.colTag]?returnValue=-1:a[this.colTag]>b[this.colTag]&&(returnValue=1),this.asc&&(returnValue*=-1),returnValue}function dateDetailSort(a,b){var returnValue=new Date(a[this.colTag])-new Date(b[this.colTag]);return this.asc&&(returnValue*=-1),returnValue}function getSortFunction(sortBy){var format=sortBy.format||"";switch(format.toUpperCase()){case"DATE":return dateDetailSort;default:return genericDetailSort}}var SECTOR_SEPARATOR="#",ReactTable=React.createClass({displayName:"ReactTable",getInitialState:ReactTabeGetInitialState,handleSort:ReactTableHandleSort,handleAdd:ReactTableHandleAdd,handleRemove:ReactTableHandleRemove,handleToggleHide:ReactTableHandleToggleHide,handleRowSelect:ReactTableHandleRowSelect,handlePageClick:ReactTableHandlePageClick,render:function(){for(var uncollapsedRows=[],i=0;i<this.state.data.length;i++){var row=this.state.data[i];shouldHide(row,this.state.collapsedSectorPaths,this.state.collapsedSectorKeys)||uncollapsedRows.push(row)}var paginationAttr=getPageArithmetics(this,uncollapsedRows),rowsToDisplay=uncollapsedRows.slice(paginationAttr.lowerVisualBound,paginationAttr.upperVisualBound+1),rows=rowsToDisplay.map(function(row){var rowKey=this.props.rowKey;return React.createElement(Row,{data:row,key:generateRowKey(row,rowKey),isSelected:rowKey&&this.state.selectedRows[row[rowKey]]?!0:!1,onSelect:this.handleRowSelect,columnDefs:this.state.columnDefs,toggleHide:this.handleToggleHide})},this),headers=buildHeaders(this),footer=buildFooter(this,paginationAttr);return React.createElement("div",null,React.createElement("table",{className:"table table-condensed"},headers,React.createElement("tbody",null,rows)),footer)}}),Row=React.createClass({displayName:"Row",render:function(){for(var cells=[buildFirstCellForRow(this.props)],i=1;i<this.props.columnDefs.length;i++){var columnDef=this.props.columnDefs[i],style={textAlign:"number"==columnDef.format?"right":"left"},cellContent="number"!=columnDef.format?this.props.data[columnDef.colTag]:this.props.data[columnDef.colTag].toFixed(2);cells.push(React.createElement("td",{style:style,key:columnDef.colTag},cellContent))}var styles={cursor:this.props.data.isDetail?"pointer":"inherit",backgroundColor:this.props.isSelected&&this.props.data.isDetail?"#fff":"inherit"};return React.createElement("tr",{onClick:this.props.onSelect.bind(null,this.props.data),style:styles},cells)}}),PageNavigator=React.createClass({displayName:"PageNavigator",render:function(){var self=this,cx=React.addons.classSet,prevClass=cx({disabled:1==this.props.activeItem}),nextClass=cx({disabled:this.props.activeItem==this.props.numPages}),items=this.props.items.map(function(item){return React.createElement("li",{key:item,className:self.props.activeItem==item?"active":""},React.createElement("a",{href:"#",onClick:self.props.handleClick.bind(null,item)},item))});return React.createElement("ul",{className:"pagination pull-right"},React.createElement("li",{className:prevClass},React.createElement("a",{href:"#",onClick:this.props.handleClick.bind(null,this.props.activeItem-1)},"«")),items,React.createElement("li",{className:nextClass},React.createElement("a",{href:"#",onClick:this.props.handleClick.bind(null,this.props.activeItem+1)},"»")))}});