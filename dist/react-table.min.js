/*! react-table 15-11-2014 Author: Erfang Chen */
function buildLAFConfigObject(a){var b=a.formatInstructions,c={multiplier:1,roundTo:2,unit:null,alignment:getColumnAlignment(a)};if(!b)return c;for(var d=b.split(/\s+/),e=0;e<d.length;e++){var f=d[e].split(":",2)[0];c[f]=d[e].split(":",2)[1]}return c}function buildCellLookAndFeel(a,b){"use strict";var c={classes:{},styles:{},value:{}},d=b[a.colTag];a.formatConfig=null!=a.formatConfig?a.formatConfig:buildLAFConfigObject(a);var e=a.formatConfig;return a.cellClassCallback&&(c.classes=a.cellClassCallback(b)),d=formatNumber(d,a,e),e.unit&&(d=d+" "+e.unit),"currency"==a.format&&(d="$"+d),c.styles.textAlign=e.alignment,c.styles.width=a.text.length+"em",c.value=d,c}function getColumnAlignment(a){"use strict";return"number"==a.format||"currency"==a.format?"right":"left"}function formatNumber(a,b,c){return isNaN(a)||"number"!=b.format&&"currency"!=b.format||(a*=c.multiplier,a=a.toFixed(c.roundTo),c.separator&&(a=applyThousandSeparator(a))),a}function applyThousandSeparator(a){var b=a.toString().split(".");return b[0]=b[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),b.join(".")}function buildCustomMenuItems(a,b){var c=[];return b.customMenuItems&&c.push(React.createElement("div",{className:"separator"}),b.customMenuItems(a,b)),c}function buildMenu(a){var b=a.table,c=a.columnDef,d=a.style,e=a.isFirstColumn,f={};"right"==d.textAlign?f.right="0%":f.left="0%";var g=React.createElement(SummarizeControl,{table:b,columnDef:c}),h=buildCustomMenuItems(b,c),i=[React.createElement("div",{className:"menu-item",onClick:b.handleSort.bind(null,c,!0)},"Sort Asc"),React.createElement("div",{className:"menu-item",onClick:b.handleSort.bind(null,c,!1)},"Sort Dsc"),g];return e?(i.push(React.createElement("div",{className:"separator"})),i.push(React.createElement("div",{className:"menu-item",onClick:b.handleGroupBy.bind(null,null)},"Clear Summary")),i.push(React.createElement("div",{className:"menu-item",onClick:b.handleCollapseAll.bind(null,null)},"Collapse All")),i.push(React.createElement("div",{className:"menu-item",onClick:b.handleExpandAll.bind(null)},"Expand All"))):i.push(React.createElement("div",{className:"menu-item",onClick:b.handleRemove.bind(null,c)},"Remove Column")),i.push(h),React.createElement("div",{style:f,className:"rt-header-menu"},i)}function buildHeaders(a){var b,c=a.state.columnDefs[0],d={},e=React.createElement("div",{className:"rt-headers-container"},React.createElement("div",{style:{textAlign:"center"},className:"rt-header-element",key:c.colTag},React.createElement("a",{className:"btn-link rt-header-anchor-text"},c.text)),buildMenu({table:a,columnDef:c,style:{textAlign:"left"},isFirstColumn:!0})),f=[e];for(b=1;b<a.state.columnDefs.length;b++)c=a.state.columnDefs[b],d={textAlign:"center"},f.push(React.createElement("div",{className:"rt-headers-container"},React.createElement("div",{style:d,className:"rt-header-element rt-info-header",key:c.colTag},React.createElement("a",{className:"btn-link rt-header-anchor-text"},c.text)),buildMenu({table:a,columnDef:c,style:d,isFirstColumn:!1})));return f.push(React.createElement("span",{className:"rt-header-element rt-add-column",style:{textAlign:"center"}},React.createElement("a",{className:"btn-link rt-plus-sign",onClick:a.handleAdd},React.createElement("strong",null,"+")))),React.createElement("div",{className:"rt-headers-grand-container"},React.createElement("div",{key:"header",className:"rt-headers"},f))}function buildFirstCellForRow(a){var b=a.data,c=a.columnDefs[0],d=a.toggleHide,e=c.colTag;if(!b.sectorPath)return React.createElement("td",{key:e},b[e]);var f=b.isDetail?b.sectorPath.length:b.sectorPath.length-1,g={paddingLeft:10+25*f+"px"};if(b.isDetail)var h=React.createElement("td",{style:g,key:e},b[e]);else h=React.createElement("td",{style:g,key:e},React.createElement("a",{onClick:d.bind(null,b),className:"btn-link"},React.createElement("strong",null,b[e])));return h}function buildFooter(a,b){return a.props.columnDefs.length>0?React.createElement(PageNavigator,{items:b.allPages.slice(b.pageDisplayRange.start,b.pageDisplayRange.end),activeItem:a.state.currentPage,numPages:b.pageEnd,handleClick:a.handlePageClick}):null}function getSectorName(a,b){var c="",d=null;if("number"==b.format||"currency"==b.format){var e=_resolveNumericSectorName(b,a);c=e.sectorName,d=e.sortIndex}else c=a[b.colTag];return{sectorName:c,sortIndex:d}}function aggregateSector(a,b,c){for(var d={},e=1;e<b.length;e++)d[b[e].colTag]=_aggregateColumn(a,b[e],c);return d}function _resolveNumericSectorName(a,b){var c="",d="";if(a.groupByRange){for(var e=0;e<a.groupByRange.length;e++)if(b[a.colTag]<a.groupByRange[e]){c=a.text+" "+(0!=e?a.groupByRange[e-1]:0)+" - "+a.groupByRange[e],d=e;break}c||(c=a.text+" "+a.groupByRange[a.groupByRange.length-1]+"+",d=e+1)}else c=a.text;return{sectorName:c,sortIndex:d}}function _resolveAggregationMethod(a,b){var c="";if(a.aggregationMethod&&(c=a.aggregationMethod),a.conditionalAggregationMethod&&b&&1==b.length){var d=b[0].colTag;a.conditionalAggregationMethod[d]&&(c=a.conditionalAggregationMethod[d])}return c.toLowerCase()}function _aggregateColumn(a,b,c){var d,e=_resolveAggregationMethod(b,c);switch(e){case"sum":d=_straightSumAggregation({data:a,columnDef:b});break;case"average":d=_average({data:a,columnDef:b});break;case"count":d=_count({data:a,columnDef:b});break;case"count_distinct":d=_countDistinct({data:a,columnDef:b});break;default:d=""}return d}function _straightSumAggregation(a){for(var b=a.data,c=a.columnDef,d=0,e=0,f=0;f<b.length;f++)e=b[f][c.colTag]||0,d+=e;return d}function _average(a){return a.columnDef.weightBy?_weightedAverage(a):_simpleAverage(a)}function _simpleAverage(a){var b=_straightSumAggregation(a);return 0==a.data.length?0:b/a.data.length}function _weightedAverage(a){for(var b=a.data,c=a.columnDef,d=a.columnDef.weightBy,e=0,f=0;f<b.length;f++)e+=(b[f][c.colTag]||0)*(b[f][d.colTag]||0);var g=_straightSumAggregation({data:b,columnDef:d});return 0==g?0:e/g}function _count(a){var b,c=a.data,d=a.columnDef,e=0;for(b=0;b<a.data.length;b++)c[b][d.colTag]&&e++;return e}function _countDistinct(a){var b,c,d=a.data,e=a.columnDef,f={};for(b=0;b<a.data.length;b++)f[d[b][e.colTag]]=1;var g=0;for(c in f)f.hasOwnProperty(c)&&g++;return 1==g?d[0][e.colTag]:g}function isRowSelected(a,b,c,d){return null!=b?null!=c[a[b]]||!a.isDetail&&null!=d[generateSectorKey(a.sectorPath)]:void 0}function generateSectorKey(a){return null==a?"":a.join(SECTOR_SEPARATOR)}function generateRowKey(a,b){var c;return c=a.isDetail?b?a[b]:a.rowCount:generateSectorKey(a.sectorPath)}function computePageDisplayRange(a,b){var c=b,d=Math.min(Math.floor(c/2),a-1),e=c-d;return{start:a-d-1,end:a+e-1}}function adjustHeaders(){var a=this.state.uniqueId,b=!1,c=0,d=$("#"+a+" .rt-headers-container"),e=parseInt(d.first().find(".rt-header-element").css("padding-left"));e+=parseInt(d.first().find(".rt-header-element").css("padding-right")),d.each(function(){var f=$(this),g=$("#"+a+" .rt-table tr:first td:eq("+c+")").outerWidth()-1;0==c&&1==parseInt(d.first().css("border-right"))&&(g+=1);var h=f.find(".rt-header-anchor-text").width()+e;f.width()>0&&h>f.width()+1&&($(this).width(h),$("#"+a).find("tr").find("td:eq("+c+")").css("min-width",h+"px"),b=!0),f.width(g),c++}),b&&adjustHeaders.call(this)}function getPageArithmetics(a,b){var c={};c.pageSize=a.props.pageSize||50,c.maxDisplayedPages=a.props.maxDisplayedPages||10,c.pageStart=1,c.pageEnd=Math.ceil(b.length/c.pageSize),c.allPages=[];for(var d=c.pageStart;d<=c.pageEnd;d++)c.allPages.push(d);return c.pageDisplayRange=computePageDisplayRange(a.state.currentPage,c.maxDisplayedPages),c.lowerVisualBound=(a.state.currentPage-1)*c.pageSize,c.upperVisualBound=Math.min(a.state.currentPage*c.pageSize-1,b.length),c}function bindHeadersToMenu(a){a.find(".rt-headers-container").each(function(){var a=this;$(a).hover(function(){var b=$(a).position();b.left&&$(a).find(".rt-header-menu").css("left",b.left+"px"),b.right&&$(a).find(".rt-header-menu").css("right",b.right+"px")})})}function uniqueId(a){var b=++idCounter+"";return a?a+b:b}function getInitialSelections(a,b){var c={selectedDetailRows:{},selectedSummaryRows:{}};if(null!=a)for(var d=0;d<a.length;d++)c.selectedDetailRows[a[d]]=1;if(null!=b)for(var d=0;d<b.length;d++)c.selectedSummaryRows[b[d]]=1;return c}function ReactTableGetInitialState(){var a=createTree(this.props),b=getInitialSelections(this.props.selectedRows,this.props.selectedSummaryRows);return{rootNode:a,uniqueId:uniqueId("table"),currentPage:1,height:this.props.height,columnDefs:this.props.columnDefs,selectedDetailRows:b.selectedDetailRows,selectedSummaryRows:b.selectedSummaryRows}}function ReactTableHandleSelect(a){var b,c=this.props.rowKey;null!=c&&(null!=a.isDetail&1==a.isDetail?(b=this.toggleSelectDetailRow(a[c]),this.props.onSelectCallback(a,b)):(b=this.toggleSelectSummaryRow(generateSectorKey(a.sectorPath)),this.props.onSummarySelectCallback(a,b)))}function ReactTableHandleSort(a,b){this.state.rootNode.sortChildren({sortFn:getSortFunction(a).bind(a),recursive:!0,sortAsc:b}),this.setState({rootNode:this.state.rootNode})}function ReactTableHandleGroupBy(a,b){null!=b&&""!=b&&a&&(a.groupByRange=_createFloatBuckets(b)),this.props.groupBy=a?[a]:null;var c=createTree(this.props);null!=a&&null!=a.groupByRange&&a.groupByRange.length>1&&c.sortChildren({sortFn:null,recursive:!1,sortAsc:!1,sortByIndex:!0}),this.setState({rootNode:c,currentPage:1})}function ReactTableHandleAdd(){this.props.beforeColumnAdd&&this.props.beforeColumnAdd()}function ReactTableHandleRemove(a){for(var b=this.state.columnDefs.indexOf(a),c=[],d=0;d<this.state.columnDefs.length;d++)d!=b&&c.push(this.state.columnDefs[d]);this.setState({columnDefs:c}),null!=this.props.afterColumnRemove&&this.props.afterColumnRemove(c,a)}function ReactTableHandleToggleHide(a,b){b.stopPropagation(),a.treeNode.collapsed=!a.treeNode.collapsed,this.setState({rootNode:this.state.rootNode})}function ReactTableHandlePageClick(a,b){b.preventDefault(),this.setState({currentPage:a})}function _createFloatBuckets(a){var b,c=0,d=[];for(b=a.split(","),c=0;c<b.length;c++){var e=parseFloat(b[c]);isNaN(e)||d.push(e),d.sort(function(a,b){return a-b})}return d}function genericValueBasedSorter(a,b){var c=0;return a[this.colTag]<b[this.colTag]?c=-1:a[this.colTag]>b[this.colTag]&&(c=1),c}function dateDetailSort(a,b){var c=new Date(a[this.colTag])-new Date(b[this.colTag]);return c}function getSortFunction(a){var b=a.format||"";if(a.sort)return a.sort;switch(b){case"date":return dateDetailSort;default:return genericValueBasedSorter}}function createTree(a){var b=buildTreeSkeleton(a);return recursivelyAggregateNodes(b,a),b}function buildTreeSkeleton(a){var b,c=new TreeNode("Grand Total",null),d=a.data;for(b=0;b<d.length;b++)c.appendRow(d[b]),_populateChildNodesForRow(c,d[b],a.groupBy);return c}function recursivelyAggregateNodes(a,b){if(a.rowData=aggregateSector(a.ultimateChildren,b.columnDefs,b.groupBy),a.children.length>0)for(var c=0;c<a.children.length;c++)recursivelyAggregateNodes(a.children[c],b)}function _populateChildNodesForRow(a,b,c){var d,e=a;if(null!=c&&0!=c.length)for(d=0;d<c.length;d++){var f=getSectorName(b,c[d]);e=e.appendRowToChildren({childSectorName:f.sectorName,childRow:b,sortIndex:f.sortIndex})}}function TreeNode(a,b){this.sectorTitle=a,this.parent=b,this.rowData=null,this.children=[],this.ultimateChildren=[],this.collapsed=null!=this.parent?!0:!1,this.sortIndex=null,this._childrenSectorNameMap={}}function _hasSortIndex(a,b){return null!=a.sortIndex&&null!=b.sortIndex&&!isNaN(a.sortIndex)&&!isNaN(a.sortIndex)}function rasterizeTree(a){var b=a.node,c=a.firstColumn;b=_decorateRowData(b,c);var d=[b.rowData];return b.collapsed||(b.children.length>0?_rasterizeChildren(d,a):_rasterizeDetailRows(b,d)),d}function _rasterizeChildren(a,b){var c,d,e,f=b.node,g=b.firstColumn;for(c=0;c<f.children.length;c++)for(e=rasterizeTree({node:f.children[c],firstColumn:g}),d=0;d<e.length;d++)a.push(e[d])}function _rasterizeDetailRows(a,b){for(var c=0;c<a.ultimateChildren.length;c++){var d=a.ultimateChildren[c];d.sectorPath=a.rowData.sectorPath,d.isDetail=!0,b.push(d)}}function _decorateRowData(a,b){return a.rowData.sectorPath=a.getSectorPath(),a.rowData[b.colTag]=a.sectorTitle,a.rowData.treeNode=a,a}var idCounter=0,SECTOR_SEPARATOR="#",ReactTable=React.createClass({displayName:"ReactTable",getInitialState:ReactTableGetInitialState,handleSort:ReactTableHandleSort,handleAdd:ReactTableHandleAdd,handleRemove:ReactTableHandleRemove,handleToggleHide:ReactTableHandleToggleHide,handleGroupBy:ReactTableHandleGroupBy,handlePageClick:ReactTableHandlePageClick,handleSelect:ReactTableHandleSelect,handleCollapseAll:function(){var a=this.state.rootNode;a.collapseImmediateChildren(),this.setState({rootNode:a,currentPage:1})},handleExpandAll:function(){var a=this.state.rootNode;a.expandRecursively(),this.setState({rootNode:a,currentPage:1})},toggleSelectDetailRow:function(a){var b,c=this.state.selectedDetailRows;return null!=c[a]?(delete c[a],b=!1):(c[a]=1,b=!0),this.setState({selectedDetailRows:c}),b},toggleSelectSummaryRow:function(a){var b,c=this.state.selectedSummaryRows;return null!=c[a]?(delete c[a],b=!1):(c[a]=1,b=!0),this.setState({selectedDetailRows:c}),b},addColumn:function(a,b){this.state.columnDefs.push(a),b&&(this.props.data=b,this.state.rootNode=createTree(this.props)),this.setState({rootNode:this.state.rootNode})},replaceData:function(a){this.props.data=a;var b=createTree(this.props);this.setState({rootNode:b,currentPage:1})},componentDidMount:function(){setTimeout(function(){adjustHeaders.call(this)}.bind(this)),document.addEventListener("click",adjustHeaders.bind(this)),window.addEventListener("resize",adjustHeaders.bind(this));var a=$(this.getDOMNode());a.find(".rt-scrollable").bind("scroll",function(){a.find(".rt-headers").css({overflow:"auto"}).scrollLeft($(this).scrollLeft()),a.find(".rt-headers").css({overflow:"hidden"})}),bindHeadersToMenu(a)},componentWillUnmount:function(){window.removeEventListener("resize",adjustHeaders.bind(this))},componentDidUpdate:function(){adjustHeaders.call(this),bindHeadersToMenu($(this.getDOMNode()))},render:function(){var a=rasterizeTree({node:this.state.rootNode,firstColumn:this.state.columnDefs[0],selectedDetailRows:this.state.selectedDetailRows}),b=getPageArithmetics(this,a),c=a.slice(b.lowerVisualBound,b.upperVisualBound+1),d=c.map(function(a){var b=this.props.rowKey;return React.createElement(Row,{data:a,isSelected:isRowSelected(a,this.props.rowKey,this.state.selectedDetailRows,this.state.selectedSummaryRows),onSelect:this.handleSelect,key:generateRowKey(a,b),columnDefs:this.state.columnDefs,toggleHide:this.handleToggleHide})},this),e=buildHeaders(this),f=buildFooter(this,b),g={};return this.state.height&&parseInt(this.state.height)>0&&(g.height=this.state.height),React.createElement("div",{id:this.state.uniqueId,className:"rt-table-container"},e,React.createElement("div",{style:g,className:"rt-scrollable"},React.createElement("table",{className:"rt-table"},React.createElement("tbody",null,d))),f)}}),Row=React.createClass({displayName:"Row",render:function(){for(var a=[buildFirstCellForRow(this.props)],b=1;b<this.props.columnDefs.length;b++){var c=this.props.columnDefs[b],d=buildCellLookAndFeel(c,this.props.data),e=React.addons.classSet,f=e(d.classes);a.push(React.createElement("td",{className:f,style:d.styles,key:c.colTag},d.value))}var e=React.addons.classSet,f=e({selected:this.props.isSelected&&this.props.data.isDetail,"summary-selected":this.props.isSelected&&!this.props.data.isDetail}),g={cursor:this.props.data.isDetail?"pointer":"inherit"};return React.createElement("tr",{onClick:this.props.onSelect.bind(null,this.props.data),className:f,style:g},a)}}),PageNavigator=React.createClass({displayName:"PageNavigator",render:function(){var a=this,b=React.addons.classSet,c=b({disabled:1==this.props.activeItem}),d=b({disabled:this.props.activeItem==this.props.numPages}),e=this.props.items.map(function(b){return React.createElement("li",{key:b,className:a.props.activeItem==b?"active":""},React.createElement("a",{href:"#",onClick:a.props.handleClick.bind(null,b)},b))});return React.createElement("ul",{className:c,className:"pagination pull-right"},React.createElement("li",{className:d},React.createElement("a",{className:c,href:"#",onClick:this.props.handleClick.bind(null,this.props.activeItem-1)},"«")),e,React.createElement("li",{className:d},React.createElement("a",{className:d,href:"#",onClick:this.props.handleClick.bind(null,this.props.activeItem+1)},"»")))}}),SummarizeControl=React.createClass({displayName:"SummarizeControl",getInitialState:function(){return{userInputBuckets:""}},handleChange:function(a){this.setState({userInputBuckets:a.target.value})},render:function(){var a=this.props.table,b=this.props.columnDef,c="number"==b.format||"currency"==b.format?React.createElement("div",{className:"menu-item-input",onHover:!0,style:{position:"absolute",top:"0%",left:"100%"}},React.createElement("label",null,"Enter Bucket(s)"),React.createElement("input",{onChange:this.handleChange,placeholder:"ex: 1,10,15"}),React.createElement("a",{onClick:a.handleGroupBy.bind(null,b,this.state.userInputBuckets),className:"btn-link"},"Ok")):null;return React.createElement("div",{onClick:null==c?a.handleGroupBy.bind(null,b,null):function(){},style:{position:"relative"},className:"menu-item menu-item-hoverable"},React.createElement("div",null,"Summarize"),c)}});TreeNode.prototype.appendRow=function(a){this.ultimateChildren.push(a)},TreeNode.prototype.collapseImmediateChildren=function(){var a;for(a=0;a<this.children.length;a++)this.children[a].collapsed=!0},TreeNode.prototype.expandRecursively=function(){var a;for(a=0;a<this.children.length;a++)this.children[a].collapsed=!1,this.children[a].expandRecursively()},TreeNode.prototype.appendRowToChildren=function(a){var b=a.childSectorName,c=a.childRow,d=a.sortIndex;if(null==this._childrenSectorNameMap[b]){var e=new TreeNode(b,this);e.sortIndex=d,this.children.push(e),this._childrenSectorNameMap[b]=e}return this._childrenSectorNameMap[b].appendRow(c),this._childrenSectorNameMap[b]},TreeNode.prototype.getSectorPath=function(){for(var a=[this.sectorTitle],b=this.parent;null!=b;)a.unshift(b.sectorTitle),b=b.parent;return a},TreeNode.prototype.sortChildren=function(a){var b=a.sortFn,c=a.recursive,d=a.sortAsc,e=a.sortByIndex,f=1==d?1:-1;if(this.children.sort(function(a,c){var d=a.rowData,g=c.rowData;return 1==e&&_hasSortIndex(a,c)?a.sortIndex-c.sortIndex:f*b(d,g)}),0==this.children.length&&this.ultimateChildren.sort(function(a,c){return f*b(a,c)}),c)for(var g=0;g<this.children.length;g++)this.children[g].sortChildren({sortFn:b,recursive:c,sortAsc:d,sortByIndex:e})};